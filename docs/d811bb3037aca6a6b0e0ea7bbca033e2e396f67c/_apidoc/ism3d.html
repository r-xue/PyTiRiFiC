

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ism3d package &mdash; ism3d 0.3.dev1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ism3d
          

          
          </a>

          
            
            
              <div class="version">
                0.3.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Specification/Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/inpfile.html">Parameter File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/casa6.html">CASA6 Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/goals.html">Design Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/ack.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/seealso.html">See also</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/reference.html">Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/demo_invert_ft.html">Invert</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Modeling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_prep.html">Example: GN20 (z~4 SMF) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_imaging.html">Example GN20: perform imaging of CO 2-1 dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_prep.html">Example: BX610 (High-z SFG) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_imaging.html">Example: BX610 (High-z SFG) : Data Imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_display.html">Example: BX610 (High-z SFG) : Examine Moment0 + 1D Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c2_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 2 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c5_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 5 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b6c3_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 6 Cycle 3 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_model_1dspec.html">Invert Visibility + Plot 1D spectra (may take a while)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_emcee.html">Example BX610: perform model fitting using method=‘emcee’</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_prep.html">Example: HXMM01 (High-z Merger)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_simulate.html">Example HXMM01: test the MS-simulation modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/test_uvsample_performance.html">Test the performance of the Image-to-MS-related modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Direct API usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/bx610.html">Bx610: Visibility-based Modeling of its line/continuum covered in two ALMA bands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/bx610.html#prepare-visibiity-data-from-the-calibrated-ms-restored-by-the-local-alma-pipeline">Prepare visibiity data from the calibrated MS restored by the local ALMA pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/bx610.html#s-band-4-cycle-2-aravena-m">2013.1.00059.S (Band 4, Cycle-2, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/bx610.html#s-band-6-cycle-3-aravena-m">2015.1.00250.S (Band 6, Cycle-3, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/bx610.html#s-band-4-cycle-5-aravena-m">2017.1.01045.S (Band 4, Cycle-5, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gn20.html">GN20:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gn20.html#prepare-visibiity-data-from-the-calibrated-ms-restored-by-the-local-alma-pipeline">Prepare visibiity data from the calibrated MS restored by the local ALMA pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gn20.html#s-band-4-cycle-2-aravena-m">2013.1.00059.S (Band 4, Cycle-2, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gn20.html#s-band-6-cycle-3-aravena-m">2015.1.00250.S (Band 6, Cycle-3, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gn20.html#s-band-4-cycle-5-aravena-m">2017.1.01045.S (Band 4, Cycle-5, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simvla.html">Simulated High-z VLA Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simvla.html#prepare-visibiity-data-from-the-calibrated-ms-restored-by-the-local-alma-pipeline">Prepare visibiity data from the calibrated MS restored by the local ALMA pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simvla.html#s-band-4-cycle-2-aravena-m">2013.1.00059.S (Band 4, Cycle-2, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simvla.html#s-band-6-cycle-3-aravena-m">2015.1.00250.S (Band 6, Cycle-3, Aravena M.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simvla.html#s-band-4-cycle-5-aravena-m">2017.1.01045.S (Band 4, Cycle-5, Aravena M.)</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Jupyter Notebook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/ism3d.html">ism3d</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ism3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>ism3d package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ism3d-package">
<h1>ism3d package<a class="headerlink" href="#ism3d-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ism3d.uvhelper.html">ism3d.uvhelper package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.cli">ism3d.uvhelper.cli module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.ft">ism3d.uvhelper.ft module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.imager">ism3d.uvhelper.imager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.logger">ism3d.uvhelper.logger module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#ism3d-uvhelper-obsolete-alma-imager-module">ism3d.uvhelper.obsolete_alma_imager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.plts">ism3d.uvhelper.plts module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper.proc">ism3d.uvhelper.proc module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html#module-ism3d.uvhelper">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ism3d.analyze">
<span id="ism3d-analyze-module"></span><h2>ism3d.analyze module<a class="headerlink" href="#module-ism3d.analyze" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.analyze.brute_analyze">
<code class="sig-prename descclassname">ism3d.analyze.</code><code class="sig-name descname">brute_analyze</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfolder</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/analyze.html#brute_analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.analyze.brute_analyze" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.analyze.chisq_analyze">
<code class="sig-prename descclassname">ism3d.analyze.</code><code class="sig-name descname">chisq_analyze</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfolder</span></em>, <em class="sig-param"><span class="n">burnin</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/analyze.html#chisq_analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.analyze.chisq_analyze" title="Permalink to this definition">¶</a></dt>
<dd><p>dict[‘p_best’]=pars[:,np.argmin(chi2)]
dict[‘p0’]=p0
dict[‘niter’]=niter
dict[‘maxiter’]=maxiter
dict[‘ftol’]=ftol
dict[‘chi2’]=chi2       # (ndim+1+niter)        chi2 at each simplex vertex
dict[‘pars’]=pars       # (ndim,ndim+1+niter)   positions of each simplex vertex
dict[‘temperature’]=temperature
dict[‘p_up’]=p_up
dict[‘p_up’]=p_lo</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.analyze.emcee_analyze">
<code class="sig-prename descclassname">ism3d.analyze.</code><code class="sig-name descname">emcee_analyze</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfolder</span></em>, <em class="sig-param"><span class="n">burnin</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">modebin</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">plotqtile</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">plotlevel</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">plotsub</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">plotcorner</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">plotburnin</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/analyze.html#emcee_analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.analyze.emcee_analyze" title="Permalink to this definition">¶</a></dt>
<dd><p># Print out the mean acceptance fraction. In general, acceptance_fraction
# has an entry for each walker so, in this case, it is a 50-dimensional
# vector.
# This number should be between approximately 0.25 and 0.5 if everything went as planned.</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.analyze.opt_analyze">
<code class="sig-prename descclassname">ism3d.analyze.</code><code class="sig-name descname">opt_analyze</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inpfile</span></em>, <em class="sig-param"><span class="n">burnin</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">copydata</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">export</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/analyze.html#opt_analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.analyze.opt_analyze" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="ism3d-cli-module">
<h2>ism3d.cli module<a class="headerlink" href="#ism3d-cli-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ism3d.cli_new">
<span id="ism3d-cli-new-module"></span><h2>ism3d.cli_new module<a class="headerlink" href="#module-ism3d.cli_new" title="Permalink to this headline">¶</a></h2>
<p>Console script for ism3d.</p>
<dl class="py function">
<dt id="ism3d.cli_new.main">
<code class="sig-prename descclassname">ism3d.cli_new.</code><code class="sig-name descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/cli_new.html#main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.cli_new.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Console script for ism3d.</p>
</dd></dl>

</div>
<div class="section" id="module-ism3d.discretize">
<span id="ism3d-discretize-module"></span><h2>ism3d.discretize module<a class="headerlink" href="#module-ism3d.discretize" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.discretize.channel_split">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">channel_split</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">w</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#channel_split"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.channel_split" title="Permalink to this definition">¶</a></dt>
<dd><p>Divivd the cloudlet model by channel in advance
to avoid doing it during channel looping</p>
<dl>
<dt>Note:</dt><dd><p>returned v has a flip sign from V_los
vrange[0] first channel velocity and vrange[1] last channel velocity</p>
<p>The returned list should have a element number of N(objs)</p>
</dd>
</dl>
<p>for ccloudlet model: fluxscale is the flux per cloud
for continuum model: fluxscale is the flux of the object within a plane</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.clouds_perchan">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">clouds_perchan</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clouds_loc</span></em>, <em class="sig-param"><span class="n">clouds_wt</span></em>, <em class="sig-param"><span class="n">sv</span></em>, <em class="sig-param"><span class="n">return_v</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#clouds_perchan"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.clouds_perchan" title="Permalink to this definition">¶</a></dt>
<dd><p>split clouds_loc by its LOS velocity</p>
<p>clouds_loc 6D cloud location
sv:    LOS velocity sampling vector</p>
<dl class="simple">
<dt>note: sv and clouds_loc.d_z are defined by flipped sign;</dt><dd><p>so we consider sv &lt;-&gt; -d_z</p>
</dd>
<dt>Ref:</dt><dd><p>The implemented method is analogous to IDL histogram’s reverse_indices:
<a class="reference external" href="https://stackoverflow.com/questions/26783719/efficiently-get-indices-of-histogram-bins-in-python">https://stackoverflow.com/questions/26783719/efficiently-get-indices-of-histogram-bins-in-python</a>
<a class="reference external" href="https://stackoverflow.com/questions/2754905/vectorized-approach-to-binning-with-numpy-scipy-in-python">https://stackoverflow.com/questions/2754905/vectorized-approach-to-binning-with-numpy-scipy-in-python</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Sparse_matrix#Compressed_sparse_row_(CSR,_CRS_or_Yale_format">https://en.wikipedia.org/wiki/Sparse_matrix#Compressed_sparse_row_(CSR,_CRS_or_Yale_format</a>)</p>
</dd>
<dt>return:</dt><dd><p>list of cloudsset: each elements contain the clouds located within each channel plane</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.lognsigma_lookup">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">lognsigma_lookup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">dname</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#lognsigma_lookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.lognsigma_lookup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>update some model parameters related to likelihood calculation</dt><dd><p>In the model properties, we have some keywords related to configing the likelihood</p>
</dd>
<dt>model and calculate log_propeorbaility:</dt><dd><p>lognsigma: used to scale noise level (in case it’s overunder estimated)</p>
</dd>
</dl>
<p>They are actually related to data (one value per dataset)
But it’s setup per object due to the input file layout (repeated for different objects, like PSF)
# we expected lognsigma is the same for one dname from all objs</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.pickplane">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">pickplane</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">im</span></em>, <em class="sig-param"><span class="n">iz</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#pickplane"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.pickplane" title="Permalink to this definition">¶</a></dt>
<dd><p>pick a channel plane from a “cube”</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.pix2sky">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">pix2sky</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">px</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">py</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pz</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#pix2sky"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.pix2sky" title="Permalink to this definition">¶</a></dt>
<dd><p>convert pixel index (zero-based)
to
the reference model coordinate system</p>
<blockquote>
<div><dl class="simple">
<dt>for line emission “cloudlet” objects:</dt><dd><p>the sky-projected rest-frame galactic coodrinates, which is centered around the object xypos)
z = LOS</p>
</dd>
<dt>for continuume emission “cloudlet” objects:</dt><dd><p>spatial-wise the sky-projected rest-frame galactic coodrinates, which is centered around the object xypos)
spectral-wise, sky-or-rest-frame wavelength or frequency</p>
</dd>
</dl>
</div></blockquote>
<p>“sky-frame” could be (angular,angular,velocity) or (distance,distance,velocity)
while typically the sky-frame is defined in angular units;
if the sky frame is defined in length the angular seperation will be converted to physical angular size.
the object redshift is required</p>
<blockquote>
<div><dl class="simple">
<dt>We assume:</dt><dd><p>inverse-RA (and pixel-x) aligns along with x
DEC (and pixel-y) aligns along with y</p>
</dd>
</dl>
<p>The functin dosn’t consider pixel rotation at this moment</p>
</div></blockquote>
<dl class="simple">
<dt>Essentially, we transfer:</dt><dd><p>ModelRef_origin-&gt;World-&gt;pix:
Then map pix index back to ModelRef Vec</p>
</dd>
</dl>
<p>mxo,myo,mzo:    the origin of the reference model</p>
<p>for cloudlet3d models:    (kpc,kpc,km/s)
for cloudlet2d models:    (kpc,kpc,Hz)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.render_component">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">render_component</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">out</span></em>, <em class="sig-param"><span class="n">im</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'iadd'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#render_component"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.render_component" title="Permalink to this definition">¶</a></dt>
<dd><p>in-plane-add model components into spectral-cube or mutil-freq MS
see other mode options: e.g. iadd/isub</p>
<blockquote>
<div><p><a class="reference external" href="https://docs.python.org/3.8/library/operator.html">https://docs.python.org/3.8/library/operator.html</a></p>
</div></blockquote>
<p>out=None return a new obect
out!=None return a reference point to the updated out</p>
<dl class="simple">
<dt>Note:</dt><dd><p>this may return a view of numpy if out is a slice</p>
</dd>
</dl>
<p>from gmake.discretize import render_component
cube=np.zeros((3,3,3))</p>
<p>cube[0,:,:]=render_component(cube[0,:,:],np.ones((3,3)),scale=5)
x=render_component(cube[0,:,:],np.ones((3,3)),scale=5)
np.may_share_memory(x,cube)</p>
<dl class="simple">
<dt>warning:</dt><dd><p>cube=render_component(cube[0,:,:],np.ones((3,3)),scale=5)
will override your cube values..
one should use instead:
cube[0,:,:]=render_component(cube[0,:,:],np.ones((3,3)),scale=5)</p>
</dd>
</dl>
<p>if im=[], it will do nothing…</p>
<dl class="simple">
<dt>if  you’re not sure out is None, maybe use:</dt><dd><p>out=render_component(out)</p>
</dd>
<dt>if  you know out is not None, use</dt><dd><p>render_component(out)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.sample_prep">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">sample_prep</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">phasecenter</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">0.01</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#sample_prep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.sample_prep" title="Permalink to this definition">¶</a></dt>
<dd><p>do some prep for uv_sample()
uvdata phasecenter
w    model image wcs</p>
<dl class="simple">
<dt>ref:</dt><dd><p><a class="reference external" href="https://mtazzari.github.io/galario/tech-specs.html">https://mtazzari.github.io/galario/tech-specs.html</a> specifically the “lower” option</p>
</dd>
</dl>
<p>tol: in units of cell size</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_render">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_render</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">uvw</span></em>, <em class="sig-param"><span class="n">phasecenter</span></em>, <em class="sig-param"><span class="n">pb</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">wideband</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_render"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_render" title="Permalink to this definition">¶</a></dt>
<dd><p>Note: psf/pb should not contain missing data
map mutiple component into one header and calculate chisq
objs:       componnet list
models:    a list of model to be mapped into the visibility model for the chisq calculation
header:    pesudo fits header
uv…:     visibility data</p>
<p>pb must match wcs</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_sample">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_sample</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">origin</span><span class="o">=</span><span class="default_value">'upper'</span></em>, <em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'nufft'</span></em>, <em class="sig-param"><span class="n">ik</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">saveuvgrid</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_sample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>#galario: scaled with fft-size</p>
<ul class="simple">
<li><p>fourier transform of a model image</p></li>
<li><p>discretized uv sampling using MS uvw</p></li>
</ul>
<p>dRA,dDec optionsare not implemented yet</p>
<dl class="simple">
<dt>method:</dt><dd><dl class="simple">
<dt>‘direct’:     brutal force direct fourier transform using summing (slow, and only okay for a couple of point sources)</dt><dd><p>linear+accurate but slow</p>
</dd>
<dt>‘interp2d’:   this is close to the method implemented in galario (in C or py_sampleImage.py)</dt><dd><p>howerver, galarios linear 2D interp method is problamtics for complicated structure
or multiple offcenter-source (as the amp / phase surface is not smooth)
see related disscussion: <a class="reference external" href="https://github.com/mtazzari/galario/pull/132#issuecomment-396703582">https://github.com/mtazzari/galario/pull/132#issuecomment-396703582</a>
Although interpolae amp/phase is an working solution up to 1% for single simple source at center or offcenter
For more cocmplicated source, the linear interpolation is insuffcient.
The issue is fixed here by introducing high-order spline interpolation, but lose linearrity in XY-UV transform</p>
</dd>
<dt>‘interp2d_ph’: the algroithm used in galario (one should alway interp phase as for point sources)</dt><dd><p>this should give the same results as galario, just slower…</p>
</dd>
<dt>‘galario’:    call galario python API interface (see the problem above)</dt><dd><p>currently, it will linear-interp amp and linear-interp phase.
different from linear-interp real/imag</p>
</dd>
</dl>
</dd>
</dl>
<p>Some options to improve presion/accuracy</p>
<blockquote>
<div><dl class="simple">
<dt>interpolate in UV (be careful) REAL/IMAG or AMP/PH (preferred)</dt><dd><p>low-order if amp/phase smooth
high-order if amp/phase complicated.</p>
</dd>
</dl>
<p>direct FFT (expensive)
oversampling UV grid (expensive)</p>
<p>disaeemble different objects (adjust input facet size) for performance and simplify UV-plane surface</p>
<p>the power pixel location within the input image determine the ripple in phase/real/imag</p>
</div></blockquote>
<p>important note:</p>
<blockquote>
<div><dl class="simple">
<dt>When using any interpolation-based method, for best precision/accurancy, it’s better to</dt><dd><ol class="arabic simple">
<li><p>keep the source emission close to the input image pixel center and perform re-phasing (i.a. dRA/dDec) in UV to get the correct results
In this way, the amp/phase is rather a smooth function, and interp2d will work best even at low-order (e.g. linear interp)</p></li>
<li><p>it’s better to interpolate amp and phase rather than interpolate real/image especially when phase (therefore real/image, this is off-center case)</p></li>
<li><p>(offset from image center) / (half image size) is roughly the sample step in one wrap</p></li>
<li><dl class="simple">
<dt>The most critical thing:</dt><dd><p>depress the phase change in the UV grid to make the “degridding” (i.a interpolate to discretc point) precise.
also be careful about uv sampling beyond UV grid range.
the phase change is determined by the source location in the fft-ready image.
dRA,dDec could help to adjust as it phaseshift is more precise rathatan shifting object location in pixel image</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
</div></blockquote>
<p>Rule:</p>
<blockquote>
<div><p>Imsize larger than twice of object size</p>
</div></blockquote>
<dl class="simple">
<dt>For estimating effeciency:</dt><dd><p>if uv.size&gt;im.size, then interpolating or nearest is likely faster</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_sample_direct">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_sample_direct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">dimsum</span><span class="o">=</span><span class="default_value">'uv'</span></em>, <em class="sig-param"><span class="n">drange</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_sample_direct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_sample_direct" title="Permalink to this definition">¶</a></dt>
<dd><p>runtime scaled with “active” pixel n (loop over active pixel)
runtime scaled with nrecord (loop over active visibility)
a run time is only acceptable for limited amount of point source</p>
<p>so it’s not using direct sm.predict only give 70% flux and high spatial freuqnecy info is loosing</p>
<dl class="simple">
<dt>sm.predict behavior:</dt><dd><p>If the input image very small 6x6, loosing flux in sm.predict:
It seems its using weighted average over a couple of cells arounds and run into issue for large uv cell (small image cell) case</p>
</dd>
</dl>
<p>casa is likley using oversampling method:</p>
<p><a class="reference external" href="https://open-bitbucket.nrao.edu/projects/CASA/repos/casa6/browse/casa5/code/synthesis/TransformMachines/WTerm.h#114">https://open-bitbucket.nrao.edu/projects/CASA/repos/casa6/browse/casa5/code/synthesis/TransformMachines/WTerm.h#114</a></p>
<p>oversampling=20 or 20xPB size
will make sure any the most rapid perips case (~pb) will be sapled by 20points.
such the phase (from joint source of the entire image) can’t change even faster than that.
even the nearest neajobour sampling will be good enough and not introduce too much error.</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_sample_interp2d">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_sample_interp2d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">origin</span><span class="o">=</span><span class="default_value">'upper'</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'ap'</span></em>, <em class="sig-param"><span class="n">ik</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">saveuvgrid</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_sample_interp2d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_sample_interp2d" title="Permalink to this definition">¶</a></dt>
<dd><p>ik=1-&gt;5; high-order is more accurate</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_sample_nearest">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_sample_nearest</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">factor</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">saveuvgrid</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_sample_nearest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_sample_nearest" title="Permalink to this definition">¶</a></dt>
<dd><p>factor:    oversampling factor
runtime scaled with oversampled plane size</p>
<p>uv-plane oversampling (using n or s keywod)
xy-zero padding around image (done manually)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.uv_sample_nufft">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">uv_sample_nufft</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">vis</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#uv_sample_nufft"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.uv_sample_nufft" title="Permalink to this definition">¶</a></dt>
<dd><p>factor:    oversampling factor
runtime scaled with oversampled plane size
<a class="reference external" href="https://cims.nyu.edu/cmcl/nufft/nufft.html">https://cims.nyu.edu/cmcl/nufft/nufft.html</a></p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.discretize.xy_render">
<code class="sig-prename descclassname">ism3d.discretize.</code><code class="sig-name descname">xy_render</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">psf</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pb</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">normalize_kernel</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/discretize.html#xy_render"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.discretize.xy_render" title="Permalink to this definition">¶</a></dt>
<dd><p>Note: psf/pb should not contain missing data</p>
<p>map a cloudlets-based model into a gridd data model (i.a FITS image-like for exporting or XY-&gt;UV tranform)</p>
<p>objs:       componnet list
obj:        target metadata (galactic center position (ra,dec), redshift, vsys, etc.)</p>
<blockquote>
<div><p>whatever information nesscarity to convert WCS units to physical units</p>
</div></blockquote>
<p>header:     data frame
loc:        cloudlet position and velocity in the physical car on-sky frame
weights:    cloudlet weights</p>
<p>convert pixel index wthin a WCS to a position in the on-sky galactic coordinates defined in the cloudlet model (ppv)</p>
<p>#   get the coordinate of tl tr pix in the galactic frame</p>
<p>#   x/y_sky is along x/y_pix
#   here we directly map x/y_gal into x/y_pix without considering RA/DEC</p>
<dl class="simple">
<dt>pb must match wcs</dt><dd><p>if    pb is set
the outcome is a images with a fluxscale of true_flux x pb</p>
</dd>
<dt>output:</dt><dd><p>cube:      the rendered/discretized intrinsic model with absolute flux-scaling
scube:     convolve(cube*PB,psf)</p>
</dd>
<dt>Note:    for a frequency-indepdent continuum+PSF model (narrow-band cases), only one convolve_fft run is needed.</dt><dd><p>for a spectral line model, the minimal number of convolve_fft runs will depend on its channel-wise extension
avoid broadcasting in additional dimension as the memory allocation may slow down the process (even slower than loop versions)
<a class="reference external" href="https://stackoverflow.com/questions/49632993/why-python-broadcasting-in-the-example-below-is-slower-than-a-simple-loop">https://stackoverflow.com/questions/49632993/why-python-broadcasting-in-the-example-below-is-slower-than-a-simple-loop</a></p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.dynamics">
<span id="ism3d-dynamics-module"></span><h2>ism3d.dynamics module<a class="headerlink" href="#module-ism3d.dynamics" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.dynamics.model_vcirc">
<code class="sig-prename descclassname">ism3d.dynamics.</code><code class="sig-name descname">model_vcirc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pot_dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/dynamics.html#model_vcirc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.dynamics.model_vcirc" title="Permalink to this definition">¶</a></dt>
<dd><p>take a dictionary describing the potential and calculaet rotation curve</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.dynamics.model_vcirc_plot">
<code class="sig-prename descclassname">ism3d.dynamics.</code><code class="sig-name descname">model_vcirc_plot</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rc</span></em>, <em class="sig-param"><span class="n">figname</span><span class="o">=</span><span class="default_value">'vcirc_plt.pdf'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/dynamics.html#model_vcirc_plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.dynamics.model_vcirc_plot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.dynamics.model_vrot">
<code class="sig-prename descclassname">ism3d.dynamics.</code><code class="sig-name descname">model_vrot</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mod_dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/dynamics.html#model_vrot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.dynamics.model_vrot" title="Permalink to this definition">¶</a></dt>
<dd><p>generate a RC from the mass-potential model</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.dynamics.model_vrot_plot">
<code class="sig-prename descclassname">ism3d.dynamics.</code><code class="sig-name descname">model_vrot_plot</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mod_obj_disk3d</span></em>, <em class="sig-param"><span class="n">figname</span><span class="o">=</span><span class="default_value">'vrot_plt.pdf'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/dynamics.html#model_vrot_plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.dynamics.model_vrot_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>mod_obj_disk3d:    just a single disk object (unitless)</p>
</dd></dl>

</div>
<div class="section" id="module-ism3d.evaluate">
<span id="ism3d-evaluate-module"></span><h2>ism3d.evaluate module<a class="headerlink" href="#module-ism3d.evaluate" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.evaluate.calc_chisq">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">calc_chisq</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">fit_dct</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inp_dct</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dat_dct</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">blobs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#calc_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.calc_chisq" title="Permalink to this definition">¶</a></dt>
<dd><p>this is the evaluating function for amoeba/lmfit and warpping around log_probalilibity()
For the compaibility purpose, p is number rather than quatity in units of p_start</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.calc_lnprob">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">calc_lnprob</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">decomp</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">nsamps</span><span class="o">=</span><span class="default_value">100000.0</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#calc_lnprob"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.calc_lnprob" title="Permalink to this definition">¶</a></dt>
<dd><p>this is the evaluating function for emcee
use internal read-only database (meta.db_global[‘dat_dct’]/meta.db_global[‘models’]) to avoid coping during threading</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.calc_lnprob2">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">calc_lnprob2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">decomp</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">nsamps</span><span class="o">=</span><span class="default_value">100000.0</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#calc_lnprob2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.calc_lnprob2" title="Permalink to this definition">¶</a></dt>
<dd><p>this is the evaluating function for emcee
use internal read-only database (meta.db_global[‘dat_dct’]/meta.db_global[‘models’]) to avoid coping during threading</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.calc_lnprob2_initializer">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">calc_lnprob2_initializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#calc_lnprob2_initializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.calc_lnprob2_initializer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.calc_wdev">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">calc_wdev</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">fit_dct</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inp_dct</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">blobs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#calc_wdev"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.calc_wdev" title="Permalink to this definition">¶</a></dt>
<dd><p>this might be slightly slower than calc_chisq due to memory usage to hold entire models
it’s not ideal for parallel calculation as the models are saved in the same object “models”</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.log_likelihood">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">log_likelihood</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">decomp</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">nsamps</span><span class="o">=</span><span class="default_value">100000.0</span></em>, <em class="sig-param"><span class="n">returnwdev</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">test_threading</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#log_likelihood"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.log_likelihood" title="Permalink to this definition">¶</a></dt>
<dd><p>the likelihood function</p>
<blockquote>
<div><dl class="simple">
<dt>step:    + fill the varying parameter into inp_dct</dt><dd><ul class="simple">
<li><p>convert inp_dct to mod_dct</p></li>
<li><p>use mod_dct to regenerate RC</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<p>theta can be quanitity here</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.log_prior">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">log_prior</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#log_prior"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.log_prior" title="Permalink to this definition">¶</a></dt>
<dd><p>pass through the likelihood prior function (limiting the parameter space)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.log_probability">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">log_probability</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">savemodel</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">decomp</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">nsamps</span><span class="o">=</span><span class="default_value">100000.0</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#log_probability"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.log_probability" title="Permalink to this definition">¶</a></dt>
<dd><p>ll+lq</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.model_eval">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">model_eval</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">nsamps</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">nv</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">saveimodel</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#model_eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.model_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>evaluate/render models under the optimizer framework</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul>
<li><p><strong>theta</strong> (<em>list</em>) – optimized parameters</p></li>
<li><p><strong>fit_dct</strong> (<em>dict</em>) – optimizer metadata</p></li>
<li><p><strong>inp_dct</strong> (<em>dict</em>) – input file metadata</p></li>
<li><p><strong>dat_dct</strong> (<em>dict</em>) – data container</p></li>
<li><p><strong>models</strong> (<em>dict, optional</em>) – model container</p></li>
<li><p><strong>the likelihood function</strong> –</p>
<dl class="simple">
<dt>step:    + fill the varying parameter into inp_dct</dt><dd><ul class="simple">
<li><p>convert inp_dct to mod_dct</p></li>
<li><p>use mod_dct to regenerate RC</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>theta can be quanitity here</strong></p></li>
<li><p><strong>returnwdev=True is a special mode reserved for lmfit</strong></p></li>
<li><p><strong>retired option</strong> (<em>returnwdev=True</em>)</p></li>
<li><p><strong>models,inp_dct0,mod_dct0=model_render(theta,fit_dct,inp_dct,meta.dat_dct_global,models=models,returnwdev=True)</strong></p></li>
<li><p><strong>wdev=[]</strong></p></li>
<li><p><strong>for tag in list(models.keys())</strong> –</p>
<dl class="simple">
<dt>if  ‘imodel&#64;’ in tag:</dt><dd><p>dname=tag.replace(‘imodel&#64;’,’’)
wdev.append(models[<a class="reference external" href="mailto:'model&#37;&#52;&#48;'+dname">‘model<span>&#64;</span>’+dname</a>].ravel().astype(np.float32))</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.uv_chisq">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">uv_chisq</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">dname</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#uv_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.uv_chisq" title="Permalink to this definition">¶</a></dt>
<dd><p>map multiple component into one header and also calculate chisq</p>
<p>models:    a list of model to be mapped into the visibility model for the chisq calculation
header:    pesudo fits header
uv…:     visibility data</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.xy_chisq">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">xy_chisq</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">dname</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em>, <em class="sig-param"><span class="n">returnwdev</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#xy_chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.xy_chisq" title="Permalink to this definition">¶</a></dt>
<dd><p>map mutiple component into one header and calculate chisq</p>
<p>models:    a list of model to be mapped into the visibility model for the chisq calculation
header:    pesudo fits header
uv…:     visibility data
the option “returnwdev” is depracated</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.evaluate.xy_chisq0">
<code class="sig-prename descclassname">ism3d.evaluate.</code><code class="sig-name descname">xy_chisq0</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">dname</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/evaluate.html#xy_chisq0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.evaluate.xy_chisq0" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>replaced by the current xy_chisq()</strong></p>
<p>map mutiple component into one header and calculate chisq</p>
<p>models:    a list of model to be mapped into the visibility model for the chisq calculation
header:    pesudo fits header
uv…:     visibility data</p>
</dd></dl>

</div>
<div class="section" id="module-ism3d.io">
<span id="ism3d-io-module"></span><h2>ism3d.io module<a class="headerlink" href="#module-ism3d.io" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.io.dct2fits">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">dct2fits</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dct</span></em>, <em class="sig-param"><span class="n">outname</span><span class="o">=</span><span class="default_value">'dct2fits'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#dct2fits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.dct2fits" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>save a non-nested dictionary into a FITS binary table
note:  not every Python object can be dumped into a FITS column,</p>
<blockquote>
<div><p>e.g. a dictionary type can be aded into a column of a astropy/Table, but
the Table can’be saved into FITS.</p>
</div></blockquote>
<dl class="simple">
<dt>example:</dt><dd><p>gmake.dct2fits(dat_dct,save_npy=True)</p>
</dd>
</dl>
<p>for npy np.save(outname.replace(‘.fits’,’.npy’),dct)</p>
</div></blockquote>
<dl class="simple">
<dt>note: we decide to save dct to HDF5 by default for a couple of reasons from now.</dt><dd><p>FITS is always stored in big-endian byte order, will cause some troubles with casacore/galario
I/O performance is worse
The “table” approach doesn’t support nesting / DatType may changed during the dct2fits-&gt;fits2dct process</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.io.dct2hdf">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">dct2hdf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dct</span></em>, <em class="sig-param"><span class="n">outname</span><span class="o">=</span><span class="default_value">'dct2hdf'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#dct2hdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.dct2hdf" title="Permalink to this definition">¶</a></dt>
<dd><p>write a Python dictionary object into a HDF5 file.
slashes are not allowed in HDF5 object names
We repalce any “/” in keys with “|” to avoid a confusion with HDF5 internal structures</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.io.dct2npy">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">dct2npy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dct</span></em>, <em class="sig-param"><span class="n">outname</span><span class="o">=</span><span class="default_value">'dct2npy'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#dct2npy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.dct2npy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.io.export_model">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">export_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">models</span></em>, <em class="sig-param"><span class="n">outdir</span><span class="o">=</span><span class="default_value">'./'</span></em>, <em class="sig-param"><span class="n">includedata</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">outname_exclude</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outname_replace</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#export_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.export_model" title="Permalink to this definition">¶</a></dt>
<dd><p>export a model set into FITS images or Measurement Sets
shortname:    a string list to get rid of from the original data image name</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.io.fits2dct">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">fits2dct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#fits2dct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.fits2dct" title="Permalink to this definition">¶</a></dt>
<dd><p>read a fits table into a none-nested dictionary
the fits table must be the “1-row” version from gmake.dct2fits</p>
<dl class="simple">
<dt>References</dt><dd><ul class="simple">
<li><p>about FITS byteorder: <a class="reference external" href="https://github.com/astropy/astropy/issues/4069">https://github.com/astropy/astropy/issues/4069</a></p></li>
</ul>
</dd>
<dt>note: we decide to save dct to HDF5 by default for a couple of reasons from now.</dt><dd><p>FITS is always stored in big-endian byte order, will cause some troubles with casacore/galario
I/O performance is worse
The “table” approach doesn’t support nesting / DatType may changed during the dct2fits-&gt;fits2dct process</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.io.hdf2dct">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">hdf2dct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hdf</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#hdf2dct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.hdf2dct" title="Permalink to this definition">¶</a></dt>
<dd><p>read a Python dictionary object from a HDF5 file
slashes are not allowed in HDF5 object names
We repalce any “|” in keys with “/” to recover the potential file directory paths in keysst</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.io.npy2dct">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">npy2dct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">npyname</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#npy2dct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.npy2dct" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.io.read_data">
<code class="sig-prename descclassname">ism3d.io.</code><code class="sig-name descname">read_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">save_data</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">fill_mask</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">fill_error</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">polaverage</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">dataflag</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">saveflag</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/io.html#read_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.io.read_data" title="Permalink to this definition">¶</a></dt>
<dd><p>read FITS/image or MS/visibilities into the dictionary</p>
<blockquote>
<div><ul class="simple">
<li><p>we set data=</p></li>
</ul>
<dl>
<dt>note:</dt><dd><p>DATA column shape in nrecord x nchan x ncorr
WEIGHT column shape in nrecord x ncorr( supposely this is the “average” value of WEIGHT_SPECTRUM along the channle-axis
WEIGHT_SPECTRUM SHAPE in nrecord x nchan x ncorr
FLAGS shape in nrecord x nchan x ncorr
(so WEIGHT_SPECTRUM is likely ~WEIGHT/NCHAN?) depending on the data model / calibration script</p>
<p><a class="reference external" href="mailto:data&#37;&#52;&#48;ms">data<span>&#64;</span>ms</a> in complex64 (not complex128)</p>
</dd>
<dt>For space-saving, we</dt><dd><ul class="simple">
<li><p>set DATA-values=np.nan when flag=True (so there is no a “flag” variable for flagging in dat_dct</p></li>
<li><dl class="simple">
<dt>when polaverage=True, we only derive stokes-I if both XX/YY (or RR/YY) are Good. If one of them are flagged, Data-Values set to np.nan</dt><dd><p>this follows the principle in the tclean()/stokes parameter
<a class="reference external" href="https://casa.nrao.edu/casadocs-devel/stable/global-task-list/task_tclean/parameters">https://casa.nrao.edu/casadocs-devel/stable/global-task-list/task_tclean/parameters</a>
<a class="reference external" href="http://casacore.github.io/casacore/StokesConverter_8h_source.html">http://casacore.github.io/casacore/StokesConverter_8h_source.html</a></p>
</dd>
</dl>
</li>
<li><p>weight doesn’t include the channel-axis (assuming the channel-wise weight variable is neligible</p></li>
</ul>
<p>XX=I+Q YY=I-Q ; RR=I+V LL=I-V =&gt; I=(XX+YY)/2 or (RR+LL)/2</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="module-ism3d.ism3d">
<span id="ism3d-ism3d-module"></span><h2>ism3d.ism3d module<a class="headerlink" href="#module-ism3d.ism3d" title="Permalink to this headline">¶</a></h2>
<p>Main module.</p>
</div>
<div class="section" id="module-ism3d.logger">
<span id="ism3d-logger-module"></span><h2>ism3d.logger module<a class="headerlink" href="#module-ism3d.logger" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="ism3d.logger.CustomFormatter">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.logger.</code><code class="sig-name descname">CustomFormatter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fmt</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">datefmt</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">style</span><span class="o">=</span><span class="default_value">'%'</span></em>, <em class="sig-param"><span class="n">validate</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/logger.html#CustomFormatter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.logger.CustomFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Formatter</span></code></p>
<p>customized logging formatter which can handle mutiple-line msgs</p>
<dl class="py method">
<dt id="ism3d.logger.CustomFormatter.format">
<code class="sig-name descname">format</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">record</span><span class="p">:</span> <span class="n">logging.LogRecord</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/logger.html#CustomFormatter.format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.logger.CustomFormatter.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Format the specified record as text.</p>
<p>The record’s attribute dictionary is used as the operand to a
string formatting operation which yields the returned string.
Before formatting the dictionary, a couple of preparatory steps
are carried out. The message attribute of the record is computed
using LogRecord.getMessage(). If the formatting string uses the
time (as determined by a call to usesTime(), formatTime() is
called to format the event time. If there is exception information,
it is formatted using formatException() and appended to the message.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="ism3d.logger.logger_config">
<code class="sig-prename descclassname">ism3d.logger.</code><code class="sig-name descname">logger_config</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logfile</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">loglevel</span><span class="o">=</span><span class="default_value">'INFO'</span></em>, <em class="sig-param"><span class="n">logfilelevel</span><span class="o">=</span><span class="default_value">'INFO'</span></em>, <em class="sig-param"><span class="n">reset</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/logger.html#logger_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.logger.logger_config" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>set up a customized logger,e.g.,</dt><dd><dl class="simple">
<dt>&gt;&gt;&gt;gmake.logger_config(logfile=’logs/test_gmake.log’,</dt><dd><p>loglevel=logging.WARNING,
logfilelevel=logging.INFO)</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.logger.logger_status">
<code class="sig-prename descclassname">ism3d.logger.</code><code class="sig-name descname">logger_status</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">root</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/logger.html#logger_status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.logger.logger_status" title="Permalink to this definition">¶</a></dt>
<dd><p>print out the current status of gmake logger</p>
</dd></dl>

</div>
<div class="section" id="module-ism3d.meta">
<span id="ism3d-meta-module"></span><h2>ism3d.meta module<a class="headerlink" href="#module-ism3d.meta" title="Permalink to this headline">¶</a></h2>
<p>Container for internal metadata/configuration variables under the program namespace</p>
<blockquote>
<div><p>inp_dct:    input parameter set (using quantities)
mod_dct:    model parameter set (using quantities)
obj_dct:    component parameter set (dimensionless, values in internal units)</p>
</div></blockquote>
<p>Input metadata                    inp_dct (can be hacked) (fixed)
Component metadata                mod_dct (lightweight) (dynamical(
Component Reference model            mod_dct (lightweight (dynamical)
Data                                dat_dct (heavy) (transite)
Models                            models (heavy) not nesscarilly filled with data (transite only exporting data)</p>
<dl class="py function">
<dt id="ism3d.meta.read_inp">
<code class="sig-prename descclassname">ism3d.meta.</code><code class="sig-name descname">read_inp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">parfile</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/meta.html#read_inp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.meta.read_inp" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>read parameters/setups from a .inp file into a dictionary nest:</dt><dd><p>inp_dct[id][keywords]=values.
inp_dct[‘comments’]=’??’
inp_dct[‘changlog’]=’??’
inp_dct[‘optimize’]=’??’</p>
</dd>
<dt>keyword value formatting</dt><dd><p>1.remove trailing/prefix space / comments
2.split my space
3.first element is the key
4.the rest elements will be filled into value</p>
<blockquote>
<div><p>more than one element : list
one element: scaler</p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.model">
<span id="ism3d-model-module"></span><h2>ism3d.model module<a class="headerlink" href="#module-ism3d.model" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.model.calc_vcirc">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">calc_vcirc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pot</span></em>, <em class="sig-param"><span class="n">rho</span></em>, <em class="sig-param"><span class="n">interp</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logr</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#calc_vcirc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.calc_vcirc" title="Permalink to this definition">¶</a></dt>
<dd><p>use interpolated vcirc to speed up vcirc calculation
decide to not use potential/interpRZPotential.py to avoid some overheads
see <a class="reference external" href="https://galpy.readthedocs.io/en/v1.5.0/reference/potentialinterprz.html#interprz">https://galpy.readthedocs.io/en/v1.5.0/reference/potentialinterprz.html#interprz</a>
logr will keep
also see: galpy.poteential.vcirc()</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.cloudlet_moms">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">cloudlet_moms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cloudlet</span></em>, <em class="sig-param"><span class="n">range</span><span class="o">=</span><span class="default_value">[[- 1, 1], [- 1, 1]]</span></em>, <em class="sig-param"><span class="n">bins</span><span class="o">=</span><span class="default_value">[10, 10]</span></em>, <em class="sig-param"><span class="n">weights</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#cloudlet_moms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.cloudlet_moms" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.model.clouds_discretize_2d">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">clouds_discretize_2d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cloudlet</span></em>, <em class="sig-param"><span class="n">axes</span><span class="o">=</span><span class="default_value">['y', 'x']</span></em>, <em class="sig-param"><span class="n">range</span><span class="o">=</span><span class="default_value">[[- 1, 1], [- 1, 1]]</span></em>, <em class="sig-param"><span class="n">bins</span><span class="o">=</span><span class="default_value">[10, 10]</span></em>, <em class="sig-param"><span class="n">weights</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#clouds_discretize_2d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.clouds_discretize_2d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.model.clouds_fromobj">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">clouds_fromobj</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em>, <em class="sig-param"><span class="n">nc</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">nv</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="n">seeds</span><span class="o">=</span><span class="default_value">[None, None, None, None]</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#clouds_fromobj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.clouds_fromobj" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>This is a wrapper function to create a cloudlet model from a object dict</dt><dd><p>it will handle type=’disk2d’/’disk3d’/’point’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.clouds_kin">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">clouds_kin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">car</span></em>, <em class="sig-param"><span class="n">rcProf</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vSigma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vRadial</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nV</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">3</span></em>, <em class="sig-param"><span class="n">return_cloudmeta</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#clouds_kin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.clouds_kin" title="Permalink to this definition">¶</a></dt>
<dd><p>attached 3D velocity components to a cloudlet model</p>
<p>return cloudmeta data will slow thing down and use more memory</p>
<dl>
<dt>Rotation Curve, e.g.</dt><dd><dl class="simple">
<dt>rcProf=(‘table’,r_quantity,vrot_quantity)</dt><dd><p>r_quatity=np.minimum(sbRad/rmax,1.)*vmax
vrot_quantity=np.minimum(sbRad/rmax,1.)*vmax</p>
</dd>
</dl>
<p>rcprof=(‘arctan’,v_ch,rad_ch)
rcprof=(‘expon’,v_ch,rad_ch)
rcprof=(‘tanh’,v_ch,rad_ch)
rcProf=(‘rho : minimum(rho/p2,1.0)*p1’,200*u.km/u.s,5*u.kpc)  # an inline function</p>
<p>#rmax=10*u.kpc
#vmax=300*u.km/u.s
#rcProf_r=np.arange(0.0,r_eff.value*10.0,r_eff.value/25.0)*r_eff.unit
#rcProf_v=np.minimum(rcProf_r/rmax,1.)*vmax</p>
</dd>
</dl>
<p>seeds:     the seed of random number generators for velocity components</p>
<dl class="simple">
<dt>subsize:    equivlent to NV in galmod</dt><dd><p>this is to ensure velocity dispersion profile is properly simulated
in the random process.</p>
</dd>
</dl>
<p>return:</p>
<blockquote>
<div><p>cloudlet positions + velocity componnets in astropy.coordinates.representation.CartersianRepresentation
coordinates are presented with the surface-brightness center as origin in the plane of the disc</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.clouds_morph">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">clouds_morph</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sbProf</span></em>, <em class="sig-param"><span class="n">fmPhi</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">fmRho</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">geRho</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bmY</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sbQ</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">rotPhi</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sbPA</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vbProf</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">seeds</span><span class="o">=</span><span class="default_value">[0, 1, 2]</span></em>, <em class="sig-param"><span class="n">cmode</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#clouds_morph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.clouds_morph" title="Permalink to this definition">¶</a></dt>
<dd><p>cloudlet generator for a 3D disk model</p>
<dl>
<dt>Face-on surface brightness profile, e.g.</dt><dd><p>sbProf=(‘sersic2d’,r_e,sersic_n)
sbProf=(‘expon2d’,r_s)
sbProf=(‘norm2d’,r_sigma)
sbProf=(‘table’,rho_quantity,sb_quantity)      # A table, which will be used for liner interepretation
sbProf=(‘point’)                               # A Point Source
sbProf=(‘rho : maximum(1-rho/p1,0.0)’,5*u.kpc) # A “Lambda” function defined by three pieces of information:</p>
<blockquote>
<div><ul class="simple">
<li><p>variable: e.g. rho</p></li>
<li><p>Expression: e.g. maximum(1-rho/p1,0.0)</p></li>
<li><p>Parameters: e.g. P1, P2…</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<p>Face-on surface brightness model (not implemented), e.g,</p>
<blockquote>
<div><p>xyProf=(‘x,y : np.exp(-(x^3+y^3’)))
xyProf=(‘image’,’model.fits’,[[x_min,x_max],[y_min,y_max]])</p>
</div></blockquote>
<p>Additional manupliation:</p>
<blockquote>
<div><dl>
<dt>fmPhi:   Add the Fourier perturbarion along the Azimuth direction</dt><dd><p>the mean surface brightness is still preserved
tuple (mode,amplitude,phi_m)</p>
<blockquote>
<div><p>phi_m is the phase angle from (x, or semimajor axis)
amplitude is normalized (0&lt;amp&lt;=1)</p>
</div></blockquote>
<p>e.g. fmPhi=(2,0.5,30*u.deg)</p>
</dd>
<dt>fmRho/gePho:</dt><dd><p>Add the Fourier peryurnation and Az-dependence stretching along the radial direction
the mean surface brightness is not preserved in the traditional sense
fmRho has a similar but not equiavelent affect as fmPhi
gePho will control the boxyness of the isophoto contour
see Peng+2010 for more details
fmRho (mode,amplititde,phi_m) : fmRho=(2,0.5,30*u.deg)
geRho C0
note: turn on both parameters will slightly slow down the function as</p>
<blockquote>
<div><p>numerical intergation is involved</p>
</div></blockquote>
</dd>
<dt>bmY:</dt><dd><p>bending mode as Peng+2010
bmY Tuple (model,amplitude)</p>
</dd>
<dt>sbQ:</dt><dd><p>the ellipse b/a ratio</p>
</dd>
<dt>rotPhi:</dt><dd><p>see peng+2010 coordinate rotation using alpha-tanh or log-tanh
this is useful for generateing spiral structures</p>
</dd>
<dt>sbPA:</dt><dd><p>ccw Rotate the enture system by sbPA</p>
</dd>
</dl>
</div></blockquote>
<p>Verticle brightness Structure, e.g.</p>
<blockquote>
<div><p>vbProf=(‘sech’,zh)
vbProf=(‘sech2’,zh)
vbProf=(‘laplace’,zs)
vbProf=None</p>
</div></blockquote>
<p>seeds:     3-element vector containing the seeds of random number generators</p>
<p>cmode:     adjust weights for each cloudlet:</p>
<blockquote>
<div><p><a class="reference external" href="https://www.astro.rug.nl/~gipsy/tsk/galmod.dc1">https://www.astro.rug.nl/~gipsy/tsk/galmod.dc1</a>
<a class="reference external" href="https://buildmedia.readthedocs.org/media/pdf/bbarolo/latest/bbarolo.pdf">https://buildmedia.readthedocs.org/media/pdf/bbarolo/latest/bbarolo.pdf</a>
see cmode
cmode=0, roughly even number density of cloudlets across the entire “restricted” 3D space.</p>
<blockquote>
<div><p>so the discretzation noise will be prop to brightness in each volume</p>
</div></blockquote>
<dl class="simple">
<dt>cmode=1, the number density of cloudlets is prop to brightness density</dt><dd><p>each cloud will have the same weight. therefore
discretization noise will be prop to square root of cloudnumber</p>
</dd>
</dl>
</div></blockquote>
<p>return:</p>
<blockquote>
<div><p>cloudlet positions in astropy.coordinates.representation.CylindiralRepresentation
The coordinates are presented with the surface-brightness center as origin in the plane of the disc</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.clouds_tosky">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">clouds_tosky</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">car</span></em>, <em class="sig-param"><span class="n">inc</span></em>, <em class="sig-param"><span class="n">pa</span></em>, <em class="sig-param"><span class="n">inplace</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#clouds_tosky"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.clouds_tosky" title="Permalink to this definition">¶</a></dt>
<dd><p>transform the cloudlet representation in galactic cartersian system to the on-sky cartersian system
here:    we assume:</p>
<blockquote>
<div><p>sky-x align with RA  (increase with RA)
sky-y align with DEC (increase with DEC)
sky-z align with LOC (away from observer)</p>
</div></blockquote>
<p>therefore , dz in the sky system is</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.cr_tanh">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">cr_tanh</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">r_in=None</em>, <em class="sig-param">r_out=None</em>, <em class="sig-param">theta_out=&lt;Quantity 90. deg&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#cr_tanh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.cr_tanh" title="Permalink to this definition">¶</a></dt>
<dd><p>See Peng+2010 Appendix A. with some scaling correction</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.get_image_size">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">get_image_size</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">u</span></em>, <em class="sig-param"><span class="n">v</span></em>, <em class="sig-param"><span class="n">pb</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">f_min</span><span class="o">=</span><span class="default_value">5.0</span></em>, <em class="sig-param"><span class="n">f_max</span><span class="o">=</span><span class="default_value">2.0</span></em>, <em class="sig-param"><span class="n">even</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#get_image_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.get_image_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the recommended image size given the (u, v) locations.
Typical call signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nxy</span><span class="p">,</span> <span class="n">dxy</span> <span class="o">=</span> <span class="n">get_image_size</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">PB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_min</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">f_max</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> (<em>array_like, float</em>) – u coordinate of the visibility points where the FT has to be sampled.
<strong>units</strong>: wavelength</p></li>
<li><p><strong>v</strong> (<em>array_like, float</em>) – v coordinate of the visibility points where the FT has to be sampled.
The length of v must be equal to the length of u.
<strong>units</strong>: wavelength</p></li>
<li><p><strong>PB</strong> (<em>float, optional</em>) – Primary beam of the antenna, e.g. 1.22*wavelength/Diameter for an idealized
antenna with uniform illumination.
<strong>units</strong>: rad</p></li>
<li><p><strong>f_min</strong> (<em>float</em>) – Size of the field of view covered by the (u, v) plane grid w.r.t. the field
of view covered by the image. Recommended to be larger than 3 for better results.
<strong>units</strong>: pure number</p></li>
<li><p><strong>f_max</strong> (<em>float</em>) – Nyquist rate: numerical factor that ensures the Nyquist criterion is satisfied when sampling
the synthetic visibilities at the specified (u, v) locations. Must be larger than 2.
The maximum (u, v)-distance covered is <cite>f_max</cite> times the maximum (u, v)-distance
of the observed visibilities.
<strong>units</strong>: pure number</p></li>
<li><p><strong>verbose</strong> (<em>bool, optional</em>) – If True, prints information on the criteria to be fulfilled by <cite>nxy</cite> and <cite>dxy</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>nxy</strong> (<em>int</em>) – Size of the image along x and y direction.
<strong>units</strong>: pixel</p></li>
<li><p><strong>dxy</strong> (<em>float</em>) – Returned only if not provided in input.
Size of the image cell, assumed equal and uniform in both x and y direction.
<strong>units</strong>: cm</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt id="ism3d.model.logger">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">logger</code><em class="property"> = &lt;Logger ism3d.model (WARNING)&gt;</em><a class="headerlink" href="#ism3d.model.logger" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Note:</dt><dd><p>performance on Quanitu/Units
<a class="reference external" href="https://docs.astropy.org/en/stable/units/#performance-tips">https://docs.astropy.org/en/stable/units/#performance-tips</a>
<a class="reference external" href="https://docs.astropy.org/en/stable/units/quantity.html#astropy-units-quantity-no-copy">https://docs.astropy.org/en/stable/units/quantity.html#astropy-units-quantity-no-copy</a>
<a class="reference external" href="https://docs.astropy.org/en/stable/units/quantity.html">https://docs.astropy.org/en/stable/units/quantity.html</a> (add functiomn argument check)</p>
</dd>
</dl>
<p>.xyz / .d_xyz is not effecient as it’s combined on-the-fly
.d_xyz</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.makekernel">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">makekernel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xpixels</span></em>, <em class="sig-param"><span class="n">ypixels</span></em>, <em class="sig-param"><span class="n">beam</span></em>, <em class="sig-param"><span class="n">pa</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">cent</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'center'</span></em>, <em class="sig-param"><span class="n">factor</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#makekernel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.makekernel" title="Permalink to this definition">¶</a></dt>
<dd><p>mode: ‘center’,’linear_interp’,’oversample’,’integrate’</p>
<p>beam=[bmaj,bmin] FWHM not (bmin,bmaj)
pa=east from north (ccw)deli</p>
<p>in pixel-size units</p>
<dl>
<dt>by default: the resulted kernel is always centered around a single pixel, and the application of</dt><dd><p>the kernel will lead to zero offset,</p>
</dd>
<dt>make a “centered” Gaussian PSF kernel:</dt><dd><dl class="simple">
<dt>e.g. npixel=7, centered at px=3</dt><dd><p>npixel=8, centered at px=4
so the single peak is always at a pixel center (not physical center)
and the function is symmetric around that pixel
the purpose of doing this is to avoid offset when the specified kernel size is
even number and you build a function peaked at a pixel edge.</p>
</dd>
</dl>
<p>is x ks (peak pixel index)
10 x 7(3) okay
10 x 8(4) okay
10 x 8(3.5) offset
for convolve (non-fft), odd ks is required (the center pixel is undoubtely index=3)</p>
<blockquote>
<div><p>even ks is not allowed</p>
</div></blockquote>
<dl class="simple">
<dt>for convolve_fft, you need to use cent=ks/2:</dt><dd><p>technically it’s not the pixel index of image center
but the center pixel is “considers”as index=4</p>
</dd>
<dt>the rule of thumb-up:</dt><dd><p>cent=floor(ks/2.) or int(ks/2) #  int() try to truncate towards zero.</p>
</dd>
</dl>
<p>note:</p>
<blockquote>
<div><dl class="simple">
<dt>Python “rounding half to even” rule vs. traditional IDL:</dt><dd><p><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.around.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.around.html</a>
<a class="reference external" href="https://realpython.com/python-rounding/">https://realpython.com/python-rounding/</a>
Python&gt;round(1.5)    # 2
Python&gt;round(0.5)    # 0
IDL&gt;round(1.5)       # 2
IDL&gt;round(0.5)       # 1</p>
</dd>
<dt>“forget about how the np.array is stored, just use the array as it is IDL;</dt><dd><p>when it comes down to shape/index, reverse the sequence”</p>
</dd>
</dl>
<p>About Undersampling Images:
<a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.convolution.discretize_model.html">http://docs.astropy.org/en/stable/api/astropy.convolution.discretize_model.html</a></p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.makepb">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">makepb</code><span class="sig-paren">(</span><em class="sig-param">header</em>, <em class="sig-param">phasecenter=None</em>, <em class="sig-param">antsize=&lt;Quantity 12. m&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#makepb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.makepb" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>make a 2D Gaussian image approximated to the ALMA (or VLA?) primary beam</dt><dd><p><a class="reference external" href="https://help.almascience.org/index.php?/Knowledgebase/Article/View/90/0/90">https://help.almascience.org/index.php?/Knowledgebase/Article/View/90/0/90</a></p>
</dd>
<dt>note: this is just a apprximate solution, assuming the the pointing is towards the reference pixel in the header</dt><dd><p>and use the first channel as the reference frequency.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.makepsf">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">makepsf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">header</span></em>, <em class="sig-param"><span class="n">beam</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'oversample'</span></em>, <em class="sig-param"><span class="n">factor</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">norm</span><span class="o">=</span><span class="default_value">'peak'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#makepsf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.makepsf" title="Permalink to this definition">¶</a></dt>
<dd><p>make a 2D Gaussian image as PSF, warapping around makekernel()
beam: tuple (bmaj,bmin,bpa) quatity in fits convention</p>
<blockquote>
<div><p>otherwise, use header bmaj/bmin/bpa</p>
</div></blockquote>
<p>size:  (nx,ny) &lt;– in the FITS convention (not other way around, or so called ij)</p>
<p>norm=’peak’ would be godo for Jy/pix-&gt;Jy/beam
output</p>
<p>Note: we choose not use Gaussian2DKernel as we want to handle customzed PSF case in upstream (as dirty beam)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.model_realize">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">model_realize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mod_dct</span></em>, <em class="sig-param"><span class="n">nc</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">nv</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="n">seeds</span><span class="o">=</span><span class="default_value">[None, None, None, None]</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#model_realize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.model_realize" title="Permalink to this definition">¶</a></dt>
<dd><p>attach clouds to “mod_dct”
This is a wrapper function to attached a cloudlet model from a object-group dict</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.model_render">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">model_render</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mod_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">saveimodel</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#model_render"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.model_render" title="Permalink to this definition">¶</a></dt>
<dd><p>render component models into the data model container.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mod_dct</strong> (<em>dict</em>) – component container with realized reference models in physical units</p></li>
<li><p><strong>dat_dct</strong> (<em>dict</em>) – data container</p></li>
<li><p><strong>models</strong> (<em>dict, optional</em>) – model container</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>models</strong> – model container with rendered model inside</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.model_setup">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">model_setup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mod_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#model_setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.model_setup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>create model container</dt><dd><p>this function can be ran only once before starting fitting iteration, so that
the memory allocation/ allication will happen once during a fitting run.
The output will provide the dataframework where the reference model can be mapped into.</p>
</dd>
</dl>
<p>it will also initilize some informationed used for modeling (e.g. sampling array / header / WCS)</p>
<p>notes on evaluating efficiency:</p>
<blockquote>
<div><p>While building the intrinsic data-model from a physical model can be expensive,
the simulated observation (2D/3D convolution) is usually the bottle-neck.</p>
<dl class="simple">
<dt>some tips to improve the effeciency:</dt><dd><ul class="simple">
<li><p>exclude empty (masked/flux=0) region for the convolution</p></li>
<li><dl class="simple">
<dt>joint all objects in the intrinsic model before the convolution, e.g.</dt><dd><p>overlapping objects, lines</p>
</dd>
</dl>
</li>
<li><p>use to low-dimension convolution when possible (e.g. for the narrow-band continumm)</p></li>
</ul>
</dd>
<dt>before splitting line &amp; cont models:</dt><dd><p>— apicall   : 2.10178  seconds —</p>
</dd>
<dt>after splitting line &amp; cont models:</dt><dd><p>— apicall   : 0.84662  seconds —</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>note: imod2d<span class="classifier">Hold emission componnets with Frequency-Dependent Spatial Distribution</span></dt><dd><p>imod3d                : Hold emission conponents with Frequency-Dependent Spatial Distribution
imodel=imod2d+imod3d  : We always keep a copy of imod2d and imod3d to improve the effeicnecy in simobs()</p>
<dl class="simple">
<dt>uvmodel: np.complex64</dt><dd><p>imodel:  np.float32</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.potential_fromobj">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">potential_fromobj</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#potential_fromobj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.potential_fromobj" title="Permalink to this definition">¶</a></dt>
<dd><p>create a abstract galpy.potential object (defined in the galactic plane frame)
which can be used to calculate circular velocity once cloud position is defined.</p>
<p>obj:    type=’poyential’
return a list of galpy.potential</p>
<p><a class="reference external" href="https://galpy.readthedocs.io/en/v1.5.0/potential.html">https://galpy.readthedocs.io/en/v1.5.0/potential.html</a></p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.pots_to_vcirc">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">pots_to_vcirc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pots</span></em>, <em class="sig-param"><span class="n">rho</span></em>, <em class="sig-param"><span class="n">pscorr</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#pots_to_vcirc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.pots_to_vcirc" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate vcirc and vrot from galactocentric distance and galpy.potential
post is a list of ponetials</p>
<p>optionally, a dispersion-based pressure correcton can be applied to provide partial support (tehrefore, decrease vrot)
pscorr=(vSigma,ExpDisk_scale_length)
note: this is only correct if the non-DM is in a exp-disk</p>
<blockquote>
<div><p>vcirc:   no pressure correction
vrot:    pressure correction</p>
</div></blockquote>
<p>optionall</p>
<p>vcirc[0,:] = rotational velocity after the correction
vcirc[1,:] = rotatipnal velocity before the correction
vcirc{2:,:] = contribution from individial potentials</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.model.uv_to_header">
<code class="sig-prename descclassname">ism3d.model.</code><code class="sig-name descname">uv_to_header</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">center</span></em>, <em class="sig-param"><span class="n">chanfreq</span></em>, <em class="sig-param"><span class="n">chanwidth</span></em>, <em class="sig-param"><span class="n">antsize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/model.html#uv_to_header"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.model.uv_to_header" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>create a header template for discreating cloudlet model before uv sampling</dt><dd><p>using accroding to UV sampling and primary beam FOV
uv.shape (nrecord,2) in units of meter
chanfreq quantity frequency array
center this could be phasecenter or somewhere near your target
antsize=12*u.m</p>
</dd>
<dt>f_max: determines the UV grid size, or set a image cell-size upper limit</dt><dd><p>a valeu of &gt;=2 would be a safe choice
(set a upper limit of cellsize)</p>
</dd>
<dt>f_min: set the UV cell-size upper limit, or a lower limit of image FOV.</dt><dd><p>a value of &gt;=3 would be translated into a FOV lager than &gt;=3 of interfeormetry sensitive scale
<a href="#id1"><span class="problematic" id="id2">**</span></a><a href="#id3"><span class="problematic" id="id4">*</span></a>set a lower limit of imsize</p>
</dd>
<dt>PB:    primary beam size, help set a lower limit of FOV</dt><dd><p>however, in terms of imaging quality metric, this is not crucial
<a href="#id5"><span class="problematic" id="id6">**</span></a><a href="#id7"><span class="problematic" id="id8">*</span></a>set a lower limit of imsize</p>
</dd>
<dt>The rule of thumbs are:</dt><dd><ul class="simple">
<li><p>make sure f_max and f_min are good enought that all spatial frequency information is presented in</p></li>
</ul>
<p>the reference models
* the FOV is large enough to covert the object.
* keep the cube size within the memory limit</p>
</dd>
</dl>
<p># note: if dxy is too large, uvsampling will involve extrapolation which is not stable.
#       if nxy is too small, uvsampling should be okay as long as you believe no stucture-amp is above that scale.
#          interplate is more or less stable.</p>
</dd></dl>

</div>
<div class="section" id="ism3d-msplot2-module">
<h2>ism3d.msplot2 module<a class="headerlink" href="#ism3d-msplot2-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ism3d.opt">
<span id="ism3d-opt-module"></span><h2>ism3d.opt module<a class="headerlink" href="#module-ism3d.opt" title="Permalink to this headline">¶</a></h2>
<p>A Module used as an abstract layer for different optimization algorithms</p>
<dl class="py function">
<dt id="ism3d.opt.amoeba_sa">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">amoeba_sa</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">p0</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">p_lo</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">p_up</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">funcargs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ftol</span><span class="o">=</span><span class="default_value">1e-05</span></em>, <em class="sig-param"><span class="n">maxiter</span><span class="o">=</span><span class="default_value">5000</span></em>, <em class="sig-param"><span class="n">temperature</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">format_prec</span><span class="o">=</span><span class="default_value">'10.0f'</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#amoeba_sa"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.amoeba_sa" title="Permalink to this definition">¶</a></dt>
<dd><p>A Python implementation of the AMOEBA / Nelder-Mead downhill-simplex algorithm for
minizing a model function</p>
<blockquote>
<div><p>loosely based on amoeba_sa.pro (IDL) from E.Rolosky with the improvements from H.Fu</p>
</div></blockquote>
<dl>
<dt>reference:</dt><dd><p><a class="reference external" href="https://github.com/fchollet/nelder-mead/blob/master/nelder_mead.py">https://github.com/fchollet/nelder-mead/blob/master/nelder_mead.py</a>
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#module-scipy.optimize">https://docs.scipy.org/doc/scipy/reference/optimize.html#module-scipy.optimize</a>
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method">https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method</a></p>
</dd>
<dt>note:</dt><dd><p>for using it as a module:
&gt;sys.path.append(“/PATH_TO_SCRIPTS/”)
&gt;from amoeba_sa import amoeba_sa</p>
</dd>
<dt>history:</dt><dd><p>20171215    RX      introduced
20171216    RX      return the result as dict</p>
</dd>
<dt>Keywords:</dt><dd><p>func:         name of the function to be evaluate
scale:        the search scale for each variable, a list with one</p>
<blockquote>
<div><p>element for each variable.</p>
</div></blockquote>
<p>funcargs:     unction optional parameters packed (dict)
p0:           initial values (ndarray)
scale:        initial scale (ndarray)
p_lo:         p_lo limit for p (ndarray)
p_up:         p_up limit for p (ndarray)</p>
</dd>
</dl>
<p>return</p>
<blockquote>
<div><p>dict</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.opt.amotry_sa">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">amotry_sa</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">psum</span></em>, <em class="sig-param"><span class="n">ihi</span></em>, <em class="sig-param"><span class="n">fac</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">temperature</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">p_up</span><span class="o">=</span><span class="default_value">inf</span></em>, <em class="sig-param"><span class="n">p_lo</span><span class="o">=</span><span class="default_value">- inf</span></em>, <em class="sig-param"><span class="n">pars</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">chi2</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">funcargs</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#amotry_sa"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.amotry_sa" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.opt.chisq_iterate">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">chisq_iterate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em>, <em class="sig-param"><span class="n">nstep</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="n">resume</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#chisq_iterate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.chisq_iterate" title="Permalink to this definition">¶</a></dt>
<dd><p>call lmfit or amoeba (scalar optimizer)</p>
<p>reference: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html">https://docs.scipy.org/doc/scipy/reference/optimize.html</a></p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.opt.emcee_iterate">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">emcee_iterate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em>, <em class="sig-param"><span class="n">nstep</span><span class="o">=</span><span class="default_value">100</span></em>, <em class="sig-param"><span class="n">resume</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#emcee_iterate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.emcee_iterate" title="Permalink to this definition">¶</a></dt>
<dd><p>RUN the sampler</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.opt.opt_iterate">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">opt_iterate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fit_dct</span></em>, <em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">models</span></em>, <em class="sig-param"><span class="n">resume</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#opt_iterate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.opt_iterate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.opt.opt_setup">
<code class="sig-prename descclassname">ism3d.opt.</code><code class="sig-name descname">opt_setup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">dat_dct</span></em>, <em class="sig-param"><span class="n">initial_model</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">copydata</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/opt.html#opt_setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.opt.opt_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>method choice guideline:</p>
<p>amoeba and lmfit-nelder is essentially the same algorithm
if there is no clear proior, one will have higher chance to find global minimal for high-dimension problems</p>
<p>leastsq or least_square requires some tunning for the step of numerical directive calculation</p>
<p>brute:    expensive one.</p>
<dl>
<dt>Notes:</dt><dd><ul>
<li><dl>
<dt>nthreads</dt><dd><p>if the calling function uses the CPU multiple-threading functon for calculations,
turn on threading in emcee may have adverse effects actually</p>
<dl>
<dt>log:</dt><dd><ul class="simple">
<li><p>didn’t find clear way to turn off threading for mkl_fft</p></li>
<li><p>mkl_num_threads doesn’t apply here</p></li>
</ul>
<dl class="simple">
<dt>mkl_fft/threads=8 emecee-threads=1</dt><dd><p>iteration:  1
Took 1.22294176419576 minutes</p>
</dd>
<dt>mkl_fft/threads=8 emecee-threads=4</dt><dd><p>iteration:  1
Took 2.3464738647143046 minutes</p>
</dd>
<dt>mkl_fft/threads=8 emecee-threads=8</dt><dd><p>iteration:  1
Took 2.845475753148397 minutes</p>
</dd>
<dt>pyfftw/threads=1 emecee-threads=1</dt><dd><p>iteration:  1
Took 2.0895618041356405 minutes</p>
</dd>
<dt>pyfftw/threads=8 emecee-threads=8</dt><dd><p>iteration:  1
Took 2.9587043801943462 minutes</p>
</dd>
<dt>pyfftw/threads=8 emecee-threads=1</dt><dd><p>iteration:  1
Took 2.0195618041356405 minutes</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>20190923:</dt><dd><p>update the dependency to emcee&gt;3.0rc2
the setup follows the guideline here:</p>
<blockquote>
<div><p><a class="reference external" href="https://emcee.readthedocs.io/en/latest/tutorials/monitor/?highlight=sampler.sample">https://emcee.readthedocs.io/en/latest/tutorials/monitor/?highlight=sampler.sample</a></p>
</div></blockquote>
</dd>
<dt>Note:</dt><dd><p>emcee-threading vs model-threading
model-threading may be ineffecient if the calculation process is not truely/fully parameliized
but some overhead can be avoid
emcee-threading will require more memory and carefully arrange input parameter to avoid heavy pickling</p>
<p>if memory allowed, using emcee-threading may be the better option generally</p>
</dd>
</dl>
<p>for method=’emcee’: sampler is an emcee object
for method=others: sampler is a dict</p>
<dl>
<dt>generate:</dt><dd><p>fit_dct:    fitting metadata
models:     model container + initilize some modeling metadata (header for vis; psf model; PB model etc.)</p>
<blockquote>
<div><p>so we don’t repeat it during iteration.</p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.plts">
<span id="ism3d-plts-module"></span><h2>ism3d.plts module<a class="headerlink" href="#module-ism3d.plts" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.plts.calc_ppbeam">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">calc_ppbeam</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">header</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#calc_ppbeam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.calc_ppbeam" title="Permalink to this definition">¶</a></dt>
<dd><p>For Radio Cubes:        ppbeam=npix/beam
For optical/IR Cubes:   ppbeam=1.0</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_makeslice">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_makeslice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">radec</span><span class="o">=</span><span class="default_value">[356.53932576899575, 12.822017913507711]</span></em>, <em class="sig-param"><span class="n">linechan</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">slicechan</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">width</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">length</span><span class="o">=</span><span class="default_value">2.5</span></em>, <em class="sig-param"><span class="n">pa</span><span class="o">=</span><span class="default_value">- 45</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_makeslice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_makeslice" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_mom0xy">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_mom0xy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">linechan</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_mom0xy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_mom0xy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_radprof">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_radprof</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_radprof"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_radprof" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_rc">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_rc</code><span class="sig-paren">(</span><em class="sig-param">pots</em>, <em class="sig-param">pscorr=None</em>, <em class="sig-param">rrange=&lt;Quantity [1.e-03</em>, <em class="sig-param">1.e+01] kpc&gt;</em>, <em class="sig-param">num=50</em>, <em class="sig-param">figname='plt_rc.pdf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_rc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_rc" title="Permalink to this definition">¶</a></dt>
<dd><p>plot rc from galpy.potential
also try:</p>
<blockquote>
<div><p><a class="reference external" href="https://galpy.readthedocs.io/en/v1.5.0/getting_started.html">https://galpy.readthedocs.io/en/v1.5.0/getting_started.html</a>
from galpy.potential import plotRotcurve</p>
</div></blockquote>
<p>pscorr=(80*u.km/u.s,10*u.kpc)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_slice">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_slice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">i</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_slice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>data model res
contsub version</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_spec1d">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_spec1d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">roi</span><span class="o">=</span><span class="default_value">'icrs; circle(356.53932576899575,12.822017913507711 , 1&quot;) # text={example}'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_spec1d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_spec1d" title="Permalink to this definition">¶</a></dt>
<dd><p>1D spectrum diagnostic plot
e.g.:</p>
<blockquote>
<div><p>plt_spec1d(‘./data_bx610.bb1.cube64x64.iter0.image.fits’)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.plts.plt_yt3d">
<code class="sig-prename descclassname">ism3d.plts.</code><code class="sig-name descname">plt_yt3d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">roi</span><span class="o">=</span><span class="default_value">'icrs; circle(356.5393156, 12.8220309, 1&quot;)'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/plts.html#plt_yt3d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.plts.plt_yt3d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-ism3d.stats">
<span id="ism3d-stats-module"></span><h2>ism3d.stats module<a class="headerlink" href="#module-ism3d.stats" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.stats.cdf2rv">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">cdf2rv</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">cdf</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#cdf2rv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.cdf2rv" title="Permalink to this definition">¶</a></dt>
<dd><p><a href="#id9"><span class="problematic" id="id10">**</span></a>** only here for backward compaibility <strong>*</strong></p>
<p>Generate a pseudo-random random variable set following a target distribution described by the CDF,
using the inverse transform / pesudo-random number sampling method</p>
<p>The input CDF is presumed to be sorted already with mono increasing trend.</p>
<p>The result should stay within the range of cdf_x</p>
<p>this is for backward compaibility
make sure</p>
<blockquote>
<div><p>x[0] cdf=0
x[-1] cdf=1</p>
</div></blockquote>
<p>icdf=interpolate.interp1d(y_cdf,x,kind=’linear’)
# icdf: inverse cumulative distribution function
# a.k.a Percent point function (inverse of <cite>cdf</cite>)
# <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous</a>
# It seems that scipy.interpolate mess up units when x.type is QUANTITY
return icdf(pick)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.custom_pdf">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">custom_pdf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">sersic_n</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#custom_pdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.custom_pdf" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>note:</dt><dd><p>the pdf values is not normalized: int(pdf*dx) is not one!</p>
</dd>
</dl>
<p>Although we can use scipy.stats, we write a customized code here to improve performance.</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.custom_ppf">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">custom_ppf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">sersic_n</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#custom_ppf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.custom_ppf" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>* we also wrap the random generator into rv_continous class *</strong>
<a href="#id11"><span class="problematic" id="id12">**</span></a>* but this inline function may have better performance without the error checking overhead in rv_continous class</p>
<p>To build a fast persodu-random genenrator for an analytical function, the key is calculate the inverse cumlutative
diftributon function or Percent Point Function  (PPF) in high precisiom:
This is the parameter reliazation values as a function of CDF (Percent point function):</p>
<blockquote>
<div><p><a class="reference external" href="https://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.stats.norm.html">https://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.stats.norm.html</a>
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous.html">https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous.html</a>
<a class="reference external" href="https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py">https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py</a>
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/special.html">https://docs.scipy.org/doc/scipy/reference/special.html</a></p>
</div></blockquote>
<p>Sometimes this function will have an analytical form, which will be good in terms of performance and precision.</p>
<p>should support vector
Although this is 1D, any fancy function can be further manupilated</p>
<p><a class="reference external" href="https://reference.wolfram.com/language/ref/InverseCDF.html">https://reference.wolfram.com/language/ref/InverseCDF.html</a></p>
<p>calculate ppf from percent cutoff for common (regularized/normalized) PDF
this can be used for inverse transform sampling</p>
<p>If “u” is an uniform random number from (0,1), then the output would be
a sample following the desired distribution
<strong>*</strong></p>
<p>see also the appendix Xue+2020</p>
<p>see also: inverseCDF.nb in MM12</p>
<p>If “-ss” is in the function name, we will use scipy.stats build-in RV class</p>
<ul class="simple">
<li><p>typicall using scipy.special will be faster</p></li>
</ul>
<p>to use this function as inverse survive function (ISF)
try:</p>
<blockquote>
<div><p>sp=1-q
x=custom_ppf(func,sp)</p>
</div></blockquote>
<p>sersic_n only works for func=”sersic2d”</p>
<dl class="simple">
<dt>The interpolation sample should stay in:</dt><dd><p>x &lt;-&gt; SF or x &lt;-&gt;log(SF) space</p>
</dd>
</dl>
<p>As it’s difficult to keep the numerical accuracy and x &lt;-&gt; CDF for large x + close to one CDF table
: when you set up a x grid, for large x, the corrspoding CDF will one due to numerical precision</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.custom_rvs">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">custom_rvs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">interp</span><span class="o">=</span><span class="default_value">0.02, 20</span></em>, <em class="sig-param"><span class="n">sersic_n</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#custom_rvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.custom_rvs" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.random.RandomState.html#numpy.random.RandomState">https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.random.RandomState.html#numpy.random.RandomState</a>
use_nprng==True:</p>
<blockquote>
<div><p>use np built-in random generator rather than the hardcoded uniform+its formula</p>
</div></blockquote>
<dl>
<dt>more ppf rvs can be found here:</dt><dd><p><a class="reference external" href="https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py">https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py</a>
scipy try to use special.fun as much as possible due to performance gain</p>
</dd>
<dt>performance:</dt><dd><p>scipy.stats.rvs is generally slowest as the wrapper
A Good in-line ITS is usually fast and comparable to rng.dist (which still use C underhood)</p>
<p>rvs=</p>
</dd>
</dl>
<p>When size is large, the ppf calculation can slow down the ITS (ur-&gt;x);
If interp is specificed as a two-element tuple, we will use the pre-calculated ur-&gt;x table to performance the transform
interp=(a,b) ; (a,b) determined the random variable PDF accuracy, in units of “scale”</p>
<blockquote>
<div><p>a: resolution (so the uncernraiy in x should be smaller than a*scale
b: beyond b*scale, the transform is truncated and we lost the PDF accuracy in the random variable.</p>
</div></blockquote>
<p>smaller a or large b will increase the computation time.</p>
<p>if interp is None then, the custom_ppf method is used and the compulation time will incrase with size=1.0
if interp is set as default, the computing time will flatten at some point as size increase.</p>
<p>When using interp for inverse transformation, the better accurate in x within a limit dynamical range setting
is determined by which part of sampling table is usable for interpolation.
For oneside or twoside function, this is typically x-SF as saving numerican value SF can catpture
x change at large x (with close to zero SF) with good enough precsion.</p>
<dl>
<dt>note: np.interp(x,xp,xf) works faster if x is sorted; however, there is cost of sorting random number</dt><dd><p>the bottleneck is here is still np.interp()
<a class="reference external" href="https://github.com/numpy/numpy/issues/10937">https://github.com/numpy/numpy/issues/10937</a></p>
</dd>
<dt>func:    string / built-in function formula</dt><dd><dl class="simple">
<dt>dict / {‘x’:x,’cdf’:cdf} cdf-x is the CDF function</dt><dd><p>{‘y’:y,’sf’:sf}   sf-x  is the surveve function</p>
</dd>
</dl>
<p>this feature is used for the case where the PPF is not analytical for the distribution</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.custom_sf">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">custom_sf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">sersic_n</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#custom_sf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.custom_sf" title="Permalink to this definition">¶</a></dt>
<dd><p>The relation between x and q (i.e. CDF) is used to transfer uniform standard random variables to the desired sampling
for a specified PDF. If .ppf can be writtten in analytical forms, we can call funtions to directly calculate.
However, if special functions are involved, the computation cost can be high and an pre-calculated transform table
can be used.</p>
<p>To Keep numerical precision and meet the sampling gridding error requirementaion (that is the sampling transfer error
in X_{i} is smaller than pixel size / bin size. It’s easier to build the table from a regular oversamped grid in x,
then calculate the crosspoding p value (within 0~1). Of course the regular oversamped x value can not go to +finity,
and an upper limit should be given:</p>
<blockquote>
<div><dl class="simple">
<dt>e.g. x_grid=np.linspace(0,100,10000) may be good enought for “expon2d”,</dt><dd><p>this means the transfered x from interpolated should have error(x)&lt;=0.01Re (as we use linear interp to
replace the actual curve), withinin 100Re (more than
enought for our modeling accuray)</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>However, another numerical problem may occare as large x may lead to very close to 1 in this case, and numercial</dt><dd><p>accurcy may degrade lead to 1: see:
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html</a>
note on _logsf
and the test_custom_ppf_learn(): x=100 will lead to q=1 rather than something cose to zero.</p>
</dd>
</dl>
<p>The solution is calculate sf=1-q=1-CDF or logsf=log(1-q)=log(1-CDF);
then the small deviation from 1 can still be acturrately represented numerically. And we can use x vs. logsf table to transfer ur to x-domain acurrate enought for gridding purpose</p>
<dl class="simple">
<dt>The computer is good at saving small number close to zero rather than a number very close to one.</dt><dd><p><a class="reference external" href="https://scicomp.stackexchange.com/questions/20629/when-should-log1p-and-expm1-be-used">https://scicomp.stackexchange.com/questions/20629/when-should-log1p-and-expm1-be-used</a></p>
</dd>
</dl>
<p>note: the interplation method is only used for the transform in which the calculatione becomes to expensive</p>
<dl class="simple">
<dt>The inverse function x=isf(sf):</dt><dd><p>if sf is a uniform (0-1) random variable, then x should follow the desired distribution</p>
</dd>
</dl>
<p>use sf instead of CDF is for numerical precsion purpose.</p>
<p>We only use this to build interpolation table for expensive case; so only func=’expon2d’ &amp; ‘sersic2d’
are implemented.</p>
</dd></dl>

<dl class="py class">
<dt id="ism3d.stats.expon2d_gen">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">expon2d_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">momtype</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">xtol</span><span class="o">=</span><span class="default_value">1e-14</span></em>, <em class="sig-param"><span class="n">badvalue</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">longname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shapes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extradoc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#expon2d_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.expon2d_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.stats._distn_infrastructure.rv_continuous</span></code></p>
<p>rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile</p>
</dd></dl>

<dl class="py class">
<dt id="ism3d.stats.laplace_gen">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">laplace_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">momtype</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">xtol</span><span class="o">=</span><span class="default_value">1e-14</span></em>, <em class="sig-param"><span class="n">badvalue</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">longname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shapes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extradoc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#laplace_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.laplace_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.stats._distn_infrastructure.rv_continuous</span></code></p>
<p>rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile</p>
</dd></dl>

<dl class="py class">
<dt id="ism3d.stats.norm2d_gen">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">norm2d_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">momtype</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">xtol</span><span class="o">=</span><span class="default_value">1e-14</span></em>, <em class="sig-param"><span class="n">badvalue</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">longname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shapes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extradoc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#norm2d_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.norm2d_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.stats._distn_infrastructure.rv_continuous</span></code></p>
<p>rho Distribution of a axisymatteric 2D distribution with a Gaussian radial profile</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.pdf2rv">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">pdf2rv</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">pdf</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#pdf2rv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.pdf2rv" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a pseudo-random random variable set following a target distribution described by the PDF
using the inverse transform / pesudo-random number sampling method</p>
<p>The result should stay within the range of pdf_x</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.stats.pdf2rv_nd">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">pdf2rv_nd</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pdf</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">sort</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">interp</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#pdf2rv_nd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.pdf2rv_nd" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a pseudo-random sample (approximately) following a target PDF specified by a n-dimension array
The inverse transform sampling approach is used without expensive MC.
see more details here:</p>
<blockquote>
<div><p><a class="reference external" href="https://stackoverflow.com/questions/21100716/fast-arbitrary-distribution-random-sampling/21101584#21101584">https://stackoverflow.com/questions/21100716/fast-arbitrary-distribution-random-sampling/21101584#21101584</a></p>
</div></blockquote>
<dl class="simple">
<dt>Note:</dt><dd><ul class="simple">
<li><p>A over-sampled PDF grid (with pdf_sort/pdf_interp=True) is preferred for accuracy.</p></li>
<li><dl class="simple">
<dt>For a input PDF with a shape of (ny,nx), the output will be</dt><dd><p>xpos=sample[0,0]
ypos=sample[1,:]
xpos and ypos will be in 0-based pixel index units (i.a.xypos=[0,0] means the first pixel center.)
This convention follow the FITS image format layout.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt id="ism3d.stats.sech">
<code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">sech</code><em class="property"> = &lt;scipy.stats._distn_infrastructure.rv_frozen object&gt;</em><a class="headerlink" href="#ism3d.stats.sech" title="Permalink to this definition">¶</a></dt>
<dd><p>logistic = exp(-x)/(1+exp(-x))^2 = 1/(2+exp(-x)+exp(x))
norm(sech) = 2 / (2+exp(-2*x)+exp(2*x))</p>
</dd></dl>

<dl class="py class">
<dt id="ism3d.stats.sechsq_gen">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">sechsq_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">momtype</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">xtol</span><span class="o">=</span><span class="default_value">1e-14</span></em>, <em class="sig-param"><span class="n">badvalue</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">longname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shapes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extradoc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#sechsq_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.sechsq_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.stats._distn_infrastructure.rv_continuous</span></code></p>
<p>rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile
this is a direct implementation for testing, one should use sech2 instead</p>
</dd></dl>

<dl class="py class">
<dt id="ism3d.stats.sersic2d_gen">
<em class="property">class </em><code class="sig-prename descclassname">ism3d.stats.</code><code class="sig-name descname">sersic2d_gen</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">momtype</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">a</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">xtol</span><span class="o">=</span><span class="default_value">1e-14</span></em>, <em class="sig-param"><span class="n">badvalue</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">longname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shapes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extradoc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/stats.html#sersic2d_gen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.stats.sersic2d_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.stats._distn_infrastructure.rv_continuous</span></code></p>
<p>rho Distribution of a axisymatteric 2D distribution with a Sersic radial profile
template from:</p>
</dd></dl>

</div>
<div class="section" id="module-ism3d.utils">
<span id="ism3d-utils-module"></span><h2>ism3d.utils module<a class="headerlink" href="#module-ism3d.utils" title="Permalink to this headline">¶</a></h2>
<p>General-purpose utility Functions used by other modules</p>
<dl class="py function">
<dt id="ism3d.utils.backup">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">backup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">move</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#backup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.backup" title="Permalink to this definition">¶</a></dt>
<dd><p>backup file / dirwectiory to be overwrite</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.check_deps">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">check_deps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">package_name</span><span class="o">=</span><span class="default_value">'gmake'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#check_deps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.check_deps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.check_setup">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">check_setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#check_setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.check_setup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.chi2red_to_lognsigma">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">chi2red_to_lognsigma</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">chi2red</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#chi2red_to_lognsigma"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.chi2red_to_lognsigma" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.convert_size">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">convert_size</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">size_bytes</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#convert_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.convert_size" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>obsolete</strong> now we use human_unit()/human_to_string()</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.eval_func">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">eval_func</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vs_func_ps</span></em>, <em class="sig-param"><span class="n">var_dict</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#eval_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.eval_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Do an inline calculation from a string expression in a lambda function-like syntax</p>
<blockquote>
<div><p>1st: element</p>
</div></blockquote>
<dl>
<dt>expr<span class="classifier">expected to be a tuple</span></dt><dd><dl class="simple">
<dt>expr[0]   string:</dt><dd><p>lamabda function-like syntax defining a anonymous function and its variable(s)
the variables’ name and content should exist in the dictionary “locals”</p>
</dd>
<dt>expr[1],expr[2],expr[3]</dt><dd><p>function parameters</p>
</dd>
</dl>
</dd>
<dt>output:</dt><dd><p>the function’s value at each points of variables under the given parameters</p>
</dd>
<dt>example:</dt><dd><p>eval_func((‘rho : minimum(rho/p2,1.0)*p1’,200*u.km/u.s,5*u.kpc),locals())</p>
<p>the function call will calculate “minimum(rho/p2,1.0)*p1” assuming
p1=200*u.km/u.s &amp; p2=5*u.kpc at each “rho” value.
Here, “rho” is a local-scope variable containing a numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.gal_flat">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">gal_flat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">im</span></em>, <em class="sig-param"><span class="n">ang</span></em>, <em class="sig-param"><span class="n">inc</span></em>, <em class="sig-param"><span class="n">cen</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">interp</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">align_major</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">fill_value</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#gal_flat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.gal_flat" title="Permalink to this definition">¶</a></dt>
<dd><p>translated from IDL/gal_flat.pro
im in (nz,ny,nx)
cen is (xc,yc)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.get_autocoor_time">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">get_autocoor_time</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">h5name</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#get_autocoor_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.get_autocoor_time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.get_dirsize">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">get_dirsize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dir</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#get_dirsize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.get_dirsize" title="Permalink to this definition">¶</a></dt>
<dd><p>get the size of a file or directory</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.get_obj_size">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">get_obj_size</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em>, <em class="sig-param"><span class="n">to_string</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#get_obj_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.get_obj_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.gmake_listpars">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">gmake_listpars</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objs</span></em>, <em class="sig-param"><span class="n">showcontent</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#gmake_listpars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.gmake_listpars" title="Permalink to this definition">¶</a></dt>
<dd><p>print out the parameter dict</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.gmake_pformat">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">gmake_pformat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fit_dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#gmake_pformat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.gmake_pformat" title="Permalink to this definition">¶</a></dt>
<dd><p>fill..
p_format            : format for values
p_format_keys       : format for p_name</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.h5ls">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">h5ls</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em>, <em class="sig-param"><span class="n">logfile</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#h5ls"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.h5ls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.h5ls_print">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">h5ls_print</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#h5ls_print"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.h5ls_print" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.hextract">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">hextract</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">header</span></em>, <em class="sig-param"><span class="n">ss</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#hextract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.hextract" title="Permalink to this definition">¶</a></dt>
<dd><p>similar to hextract.pro or hextract3d.pro in idl_moments
However, it can also process stokes spectral cube
prange can be something like:</p>
<blockquote>
<div><dl class="simple">
<dt>a list of two element tuple:</dt><dd><p>[(0,2),(218,220),(218,250),(222,230)]</p>
</dd>
<dt>or a list of slice</dt><dd><p>np.s_[1:5,1::5]=(slice(1, 5, None), slice(1, None, 5))</p>
</dd>
</dl>
<p>or a list of slice expression string (from make_slice)</p>
</div></blockquote>
<p>e.g. subim,subhd=hextract(im,hd,np.s_[:,:,(256-3):(256+3),(256-3):(256+3)])</p>
<dl class="simple">
<dt>two operations are performed:</dt><dd><p>slice the original data array
update the header crpix value</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.human_to_string">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">human_to_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">format_string</span><span class="o">=</span><span class="default_value">'{0.value:0.2f} {0.unit:shortname}'</span></em>, <em class="sig-param"><span class="n">nospace</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#human_to_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.human_to_string" title="Permalink to this definition">¶</a></dt>
<dd><p>A slightly more fancy version of quality.to_string()
add the option of 0.units:shortname in formating string syntax
# <a class="reference external" href="https://docs.astropy.org/en/stable/units/format.html#astropy-units-format">https://docs.astropy.org/en/stable/units/format.html#astropy-units-format</a></p>
<dl class="simple">
<dt>format: forwarded to .to_string(format):</dt><dd><p>options: generic, unscaled, cds, console, fits, latex, latex_inline, ogip, unicode, vounit</p>
</dd>
<dt>format_string: {0:0.2f} {1}</dt><dd><p>help format you output when output=’string’</p>
</dd>
<dt>output:</dt><dd><p>‘string’:       a string represent the input quantity in best-guess unit</p>
</dd>
</dl>
<p>For time:           try built-in astropy.utils.console.human_time()
For file size:      one may also use astropy.utils.concolse.human_file_size()</p>
<p>print(human_to_string(q,format_string=’{0.value:0.2f} {0.unit:shortname}’,nospace=False))
print(human_to_string(q,format_string=’{0.value:0.2f}{0.unit:shortname}’,nospace=True))
print(human_to_string(q,format_string=’{0.value:0.2f}{0.unit:cds}’,nospace=True))
print(human_to_string(q,format_string=’{0.value:0.2f} in {0.unit:shortname}’,nospace=True))
print(human_to_string(q,format_string=’{0.value:0.2f} in {0.unit:cds}’,nospace=True))</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.human_unit">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">human_unit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">quantity</span></em>, <em class="sig-param"><span class="n">return_unit</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">base_index</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">scale_range</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#human_unit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.human_unit" title="Permalink to this definition">¶</a></dt>
<dd><p>Sugguest a better unit for the quantity and make it more human readable
e.g. 1200 m/s -&gt; 1.2 km/s</p>
<dl class="simple">
<dt>return_unit:</dt><dd><p>False:          return the input quantity in a suggested unit
True:           just return a suggested unit</p>
</dd>
<dt>base_index:</dt><dd><p>the index of the unitbase which we examine its prefix possibility.</p>
</dd>
</dl>
<p>For time:           try built-in astropy.utils.console.human_time()
For file size:      one may also use astropy.utils.concolse.human_file_size()</p>
<p>reference:    <a class="reference external" href="https://docs.astropy.org/en/stable/_modules/astropy/units/core.html">https://docs.astropy.org/en/stable/_modules/astropy/units/core.html</a></p>
<p>have tried the functions below,they work similar for PrefixUnit, but they dont work well
with composited units (e.g. u.km/u.s)</p>
<blockquote>
<div><p>get_current_unit_registry().get_units_with_physical_type(unit)
unit.find_equivalent_units(include_prefix_units=True)
unit.compose(include_prefix_units=True) might work but the results can be unexpected</p>
</div></blockquote>
<dl class="simple">
<dt>note:</dt><dd><p>get_units_with_same_physical_type() is a private method, since end users should be encouraged
to use the more powerful <cite>compose</cite> and <cite>find_equivalent_units</cite>
methods (which use this under the hood).</p>
</dd>
</dl>
<p>help find the best human readable unit
then you can do q.to_string(unit=’*’)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.imcontsub">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">imcontsub</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">imagename</span></em>, <em class="sig-param"><span class="n">linefile</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">contfile</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">fitorder</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">linechan</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">contchan</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#imcontsub"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.imcontsub" title="Permalink to this definition">¶</a></dt>
<dd><p>linechan / contchan: tuple with [fmin,fmax] in each element</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.inp2mod">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">inp2mod</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#inp2mod"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.inp2mod" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Input Parameter Dictionary to Model Properties Dictionary</p>
<dl class="simple">
<dt>The code will make a dictionary ready for model constructions, including:</dt><dd><ul class="simple">
<li><p>add the default values</p></li>
<li><p>fill optional keywords</p></li>
<li><p>fill the “tied” values</p></li>
</ul>
</dd>
</dl>
<p>inp_dct</p>
<p>–&gt; write_par (changed some modeling parameter values, e.g. shifting during the optimization iteration)</p>
<p>inp_dct_modified</p>
<p>–&gt; inp2mod (fullfill the default value / ties / reject comments &lt;– act as a formatter)</p>
<p>mod_dct</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.inp_validate">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">inp_validate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#inp_validate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.inp_validate" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>validate the input parameters, will do the follows step by step</dt><dd><ol class="arabic simple">
<li><p>check if the variable type against its type definition</p></li>
<li><p>for quanity, check the physical_type use .is_eqivalent(default_unit)</p></li>
</ol>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.make_slice">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">make_slice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">expr</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#make_slice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.make_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>parsing the slicing syntax in STRING</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.moments">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">moments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">imagename</span></em>, <em class="sig-param"><span class="n">outname</span><span class="o">=</span><span class="default_value">'test'</span></em>, <em class="sig-param"><span class="n">maskname</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">linechan</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#moments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.moments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.obj_defunit">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">obj_defunit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#obj_defunit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.obj_defunit" title="Permalink to this definition">¶</a></dt>
<dd><p>convert quatity to values in default internal units</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.one_beam">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">one_beam</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fitsname</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#one_beam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.one_beam" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.paste_array">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">paste_array</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wall</span></em>, <em class="sig-param"><span class="n">block</span></em>, <em class="sig-param"><span class="n">loc</span></em>, <em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'replace'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#paste_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.paste_array" title="Permalink to this definition">¶</a></dt>
<dd><p>past a small array into a larger array with shifting
works for high dimension or off-edge cases
wall/block requires in the same dimension number
loc: the index of left-bottom pixel of block in wall.</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.paste_slice">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">paste_slice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tup</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#paste_slice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.paste_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>make slice for the overlapping region</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.pprint">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">pprint</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#pprint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.pprint" title="Permalink to this definition">¶</a></dt>
<dd><p>A modified pprint.pprint without sorting dictionary keys</p>
<dl class="simple">
<dt>this may not be neccsary with Py38+ as optional keyword sort_dicts become available</dt><dd><p><a class="reference external" href="https://docs.python.org/3/library/pprint.html">https://docs.python.org/3/library/pprint.html</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.read_par">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">read_par</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">par_name</span></em>, <em class="sig-param"><span class="n">to_value</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#read_par"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.read_par" title="Permalink to this definition">¶</a></dt>
<dd><p>read parameter quantity / values (in default units) from a parameter dictionary
this function can handle literal slicing and attribute syntax</p>
<blockquote>
<div><dl class="simple">
<dt>e.g.:   par_str[ind_str]&#64;section_name</dt><dd><p><a class="reference external" href="mailto:par_str&#46;attrubute&#37;&#52;&#48;section_name">par_str<span>&#46;</span>attrubute<span>&#64;</span>section_name</a></p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.read_range">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">read_range</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">center</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">delta</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'a'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#read_range"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.read_range" title="Permalink to this definition">¶</a></dt>
<dd><p>modifiy the parameter exploring bounrdary according to the info from opt section
a:    absolute</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.repr_parameter">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">repr_parameter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">v</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#repr_parameter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.repr_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Similiar to the built-in repr(), but can handle Quantity / SkyCoord
used for writing input files</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.rng_seeded">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">rng_seeded</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#rng_seeded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.rng_seeded" title="Permalink to this definition">¶</a></dt>
<dd><p>return a seeded RNG plus is_mkl
mkl_random is preferrred over numpy.random</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.rotate_xy">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">rotate_xy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">angle</span></em>, <em class="sig-param"><span class="n">xo</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">yo</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#rotate_xy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.rotate_xy" title="Permalink to this definition">¶</a></dt>
<dd><p>rotate points in a 2D coordinate system
angle:    rotate points by angle in CCW
ref:    rotate_xy.pro rot_3d.pro
performance consideration:</p>
<blockquote>
<div><p><a class="reference external" href="https://gist.github.com/LyleScott/e36e08bfb23b1f87af68c9051f985302">https://gist.github.com/LyleScott/e36e08bfb23b1f87af68c9051f985302</a>
<a class="reference external" href="https://stackoverflow.com/questions/33004551/why-is-b-numpy-dota-x-so-much-slower-looping-through-doing-bi-numpy">https://stackoverflow.com/questions/33004551/why-is-b-numpy-dota-x-so-much-slower-looping-through-doing-bi-numpy</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Rotation_matrix">https://en.wikipedia.org/wiki/Rotation_matrix</a></p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.sample_grid">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">sample_grid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">spacing</span></em>, <em class="sig-param"><span class="n">xrange</span><span class="o">=</span><span class="default_value">[- 100, 100]</span></em>, <em class="sig-param"><span class="n">yrange</span><span class="o">=</span><span class="default_value">[- 100, 100]</span></em>, <em class="sig-param"><span class="n">center</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ratio</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">angle</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#sample_grid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.sample_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>this is loosely based on my sample_grid.pro in IDL with improvement on defining x-/y-range
angle in rad
ratio=major/minor</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.set_threads">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">set_threads</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#set_threads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.set_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>some underline alrgoithm library can use OMP
turn on OMP is beneficial for iteration optimizwer but not for parallele optimizer
this function can turn on / turn off OMP in modelling alrothjm</p>
<dl class="simple">
<dt>ref:</dt><dd><p>looks like os.environ will only work before import packages
after the packages are imported, changing os.environ can not dynamically
switching nthreads</p>
</dd>
</dl>
<p><a class="reference external" href="https://software.intel.com/en-us/mkl-linux-developer-guide-mkl-domain-num-threads">https://software.intel.com/en-us/mkl-linux-developer-guide-mkl-domain-num-threads</a>
<a class="reference external" href="http://www.diracprogram.org/doc/release-17/installation/mkl.html">http://www.diracprogram.org/doc/release-17/installation/mkl.html</a>
<a class="reference external" href="https://software.intel.com/en-us/blogs/2018/10/18/mkl-service-package-controlling-mkl-behavior-through-python-interfaces">https://software.intel.com/en-us/blogs/2018/10/18/mkl-service-package-controlling-mkl-behavior-through-python-interfaces</a></p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.sort_on_runtime">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">sort_on_runtime</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#sort_on_runtime"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.sort_on_runtime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="ism3d.utils.unit_shortname">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">unit_shortname</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">unit</span></em>, <em class="sig-param"><span class="n">nospace</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">options</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#unit_shortname"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.unit_shortname" title="Permalink to this definition">¶</a></dt>
<dd><p>convert unit to shortest name
e.g.: (unit_shortname(u.Jy*u.km/u.s,nospace=False)</p>
<p>In [5]: unit_shortname(u.Jy*u.km/u.s,nospace=False)
Out[5]: ‘Jy km / s’</p>
<p>In [6]: unit_shortname(u.Jy*u.km/u.s,nospace=True)
Out[6]: ‘Jykm/s’</p>
<p>ref:
<a class="reference external" href="https://docs.astropy.org/en/stable/units/format.html#astropy-units-format">https://docs.astropy.org/en/stable/units/format.html#astropy-units-format</a></p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.write_inp">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">write_inp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">inpfile</span><span class="o">=</span><span class="default_value">'example.inp'</span></em>, <em class="sig-param"><span class="n">overwrite</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#write_inp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.write_inp" title="Permalink to this definition">¶</a></dt>
<dd><p>write out inp files from inp_dct
if overwrite=False, the function will try to append .0/.1/.2… to the .inp file name
writepar is two-element tuple, first element is the key name to be modified</p>
<blockquote>
<div><p>second element is the value</p>
</div></blockquote>
<p>note: py&gt;=3.7 use the ordered dict by default (so the output keyword order is preserved)</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.utils.write_par">
<code class="sig-prename descclassname">ism3d.utils.</code><code class="sig-name descname">write_par</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp_dct</span></em>, <em class="sig-param"><span class="n">par_name</span></em>, <em class="sig-param"><span class="n">par_value</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/utils.html#write_par"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.utils.write_par" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>write parameter values</dt><dd><p>key:    par_str[ind_str]&#64;obj_str</p>
</dd>
<dt>example:</dt><dd><p>test=read_par(inp_dct,’xypos[0]&#64;co76’)
print(test)
test=read_par(inp_dct,’<a class="reference external" href="mailto:vrot&#37;&#52;&#48;co76">vrot<span>&#64;</span>co76</a>’)
print(test)
test=read_par(inp_dct,’vrot[0:2]&#64;co76’)
print(test)
write_par(inp_dct,’vrot[0:2]&#64;co76’,[2,5])
test=read_par(inp_dct,’<a class="reference external" href="mailto:vrot&#37;&#52;&#48;co76">vrot<span>&#64;</span>co76</a>’)
print(test)</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.vis_utils">
<span id="ism3d-vis-utils-module"></span><h2>ism3d.vis_utils module<a class="headerlink" href="#module-ism3d.vis_utils" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.vis_utils.corrupt_ms">
<code class="sig-prename descclassname">ism3d.vis_utils.</code><code class="sig-name descname">corrupt_ms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vis</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">'simplenoise'</span></em>, <em class="sig-param"><span class="n">simplenoise</span><span class="o">=</span><span class="default_value">'1mJy'</span></em>, <em class="sig-param"><span class="n">inputvis</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">delscratch</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/vis_utils.html#corrupt_ms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.vis_utils.corrupt_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>use simulated tool</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.vis_utils.cpredict_ms">
<code class="sig-prename descclassname">ism3d.vis_utils.</code><code class="sig-name descname">cpredict_ms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vis</span></em>, <em class="sig-param"><span class="n">fitsimage</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputvis</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pbcor</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">delscratch</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/vis_utils.html#cpredict_ms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.vis_utils.cpredict_ms" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Using casatools.simulator to:</dt><dd><ul class="simple">
<li><p>generate UV model from a FITS image with primary beam model applied</p></li>
<li><p>insert it into the data column of MS</p></li>
</ul>
</dd>
</dl>
<p>the fits image is expected to have the correct flux scaling (true flux)
pbcor=True will do pbeam rescaling before sending images to FFT;</p>
<blockquote>
<div><p>which assume fitsimage is in absolute flux scale</p>
</div></blockquote>
<p>it DOES check interm of frequency gridding</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.vis_utils.gpredict_ms">
<code class="sig-prename descclassname">ism3d.vis_utils.</code><code class="sig-name descname">gpredict_ms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vis</span></em>, <em class="sig-param"><span class="n">fitsimage</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputvis</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pb</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pbaverage</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">antsize</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'nufft'</span></em>, <em class="sig-param"><span class="n">ik</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">saveuvgrid</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/vis_utils.html#gpredict_ms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.vis_utils.gpredict_ms" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Using galario to:</dt><dd><ul class="simple">
<li><p>generate UV model from a FITS image with primary beam model applied</p></li>
<li><p>insert it into the data column of MS</p></li>
</ul>
</dd>
</dl>
<p>the fits image is expected to have the correct flux scaling (true flux)</p>
<p><strong>**pb is assumed to have the same WCS as fitsimage***</strong></p>
<dl class="simple">
<dt>pb!=None or antsize!=None will do pbeam rescaling before sending images to FFT;</dt><dd><p>which assume fitsimage is in absolute flux scale</p>
</dd>
</dl>
<p>it doesn’t check interm of frequency gridding</p>
<p>fitsimage:    a list of string or string</p>
</dd></dl>

<dl class="py function">
<dt id="ism3d.vis_utils.read_ms">
<code class="sig-prename descclassname">ism3d.vis_utils.</code><code class="sig-name descname">read_ms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vis</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">polaverage</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">dataflag</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">saveflag</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">nodata</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">usedouble</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">dat_dct</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/vis_utils.html#read_ms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.vis_utils.read_ms" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Note:</dt><dd><p>the different output sequence
casacore.table.getcol():     nrecord x nchan x ncorr
casatools.table.getcol():    ncorr x nchan x nrecord</p>
</dd>
<dt>dataflag: default=False</dt><dd><p>set flagged data value to np.nan, which may lead to troubles of calculating chisq2</p>
</dd>
<dt>saveflag: default=True</dt><dd><p>save flagging (bool) column, which is need to figure out channel-wise bad data</p>
</dd>
<dt>nodata=True:</dt><dd><p>only read the MS “framework” from MS, not the actual dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.vis_utils.write_ms">
<code class="sig-prename descclassname">ism3d.vis_utils.</code><code class="sig-name descname">write_ms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vis</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">datacolumn</span><span class="o">=</span><span class="default_value">'corrected'</span></em>, <em class="sig-param"><span class="n">inputvis</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/vis_utils.html#write_ms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.vis_utils.write_ms" title="Permalink to this definition">¶</a></dt>
<dd><p>attach new visibility data/model values into an MS</p>
<p>if the specified datacolumn doesn’t exist, it will be created on-the-fly.</p>
<dl class="simple">
<dt>note:</dt><dd><p>the input data shape is nrecord x nchan x ncorr following the rule in casacore.table.getcol(),
which is reversed from casa6.casatools.table.getcol() (ncorr x nchan x nrecord)
alternatively, ncrecord x nchan (stokes-I) is also fine and will be broadcasted to all correlations
(assumed to be RR, LL, XX, or YY)</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ism3d" title="Permalink to this headline">¶</a></h2>
<p>Top-level package for ism3d.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Rui Xue

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>