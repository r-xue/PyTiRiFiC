

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ism3d.simuv.ft.uv_sample &mdash; ism3d 0.3.dev1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ism3d.simuv.ft.uv_sample_direct" href="ism3d.simuv.ft.uv_sample_direct.html" />
    <link rel="prev" title="ism3d.simuv.ft" href="ism3d.simuv.ft.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ism3d
          

          
          </a>

          
            
            
              <div class="version">
                0.3.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Specification/Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/inpfile.html">Parameter File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/casa6.html">CASA6 Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/goals.html">Design Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/ack.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/seealso.html">See also</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/dictionary.html">ISM3D Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/callgraph.html">ISM3D call graph</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Direct API Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_uvhelper.html">ism3d.uvhelper: visibility imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_arts.html">ism3d.arts/.simxy/ism3d.simuv: modeling in the image/visibility-domain</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/demo_invert_ft.html">Invert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/test_uvsample_performance.html">Test the performance of the Image-to-MS-related modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Modeling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c2_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 2 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c5_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 5 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b6c3_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 6 Cycle 3 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_model_1dspec.html">Invert Visibility + Plot 1D spectra (may take a while)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_emcee.html">Example BX610: perform model fitting using method=‘emcee’</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_simulate.html">Example HXMM01: test the MS-simulation modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Data Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_prep.html">Example: GN20 (z~4 SMF) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_prep.html">Example: BX610 (High-z SFG) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_prep.html">Example: HXMM01 (High-z Merger)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_imaging.html">Example GN20: perform imaging of CO 2-1 dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_imaging.html">Example: BX610 (High-z SFG) : Data Imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="ism3d.html">ism3d</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ism3d.arts.html">ism3d.arts</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.ism3d.html">ism3d.ism3d</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.logger.html">ism3d.logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.maths.html">ism3d.maths</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.modeling.html">ism3d.modeling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ism3d.simuv.html">ism3d.simuv</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="ism3d.simuv.ft.html">ism3d.simuv.ft</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">ism3d.simuv.ft.uv_sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="ism3d.simuv.ft.uv_sample_direct.html">ism3d.simuv.ft.uv_sample_direct</a></li>
<li class="toctree-l4"><a class="reference internal" href="ism3d.simuv.ft.uv_sample_interp2d.html">ism3d.simuv.ft.uv_sample_interp2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="ism3d.simuv.ft.uv_sample_nearest.html">ism3d.simuv.ft.uv_sample_nearest</a></li>
<li class="toctree-l4"><a class="reference internal" href="ism3d.simuv.ft.uv_sample_nufft.html">ism3d.simuv.ft.uv_sample_nufft</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ism3d.simuv.render.html">ism3d.simuv.render</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.simxy.html">ism3d.simxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.utils.html">ism3d.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.uvhelper.html">ism3d.uvhelper</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.visualize.html">ism3d.visualize</a></li>
<li class="toctree-l2"><a class="reference internal" href="ism3d.xyhelper.html">ism3d.xyhelper</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ism3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="ism3d.html">ism3d</a> &raquo;</li>
        
          <li><a href="ism3d.simuv.html">ism3d.simuv</a> &raquo;</li>
        
          <li><a href="ism3d.simuv.ft.html">ism3d.simuv.ft</a> &raquo;</li>
        
      <li>ism3d.simuv.ft.uv_sample</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ism3d-simuv-ft-uv-sample">
<h1>ism3d.simuv.ft.uv_sample<a class="headerlink" href="#ism3d-simuv-ft-uv-sample" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="ism3d.simuv.ft.uv_sample">
<code class="sig-prename descclassname">ism3d.simuv.ft.</code><code class="sig-name descname">uv_sample</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">plane</span></em>, <em class="sig-param"><span class="n">cell</span></em>, <em class="sig-param"><span class="n">uu</span></em>, <em class="sig-param"><span class="n">vv</span></em>, <em class="sig-param"><span class="n">dRA</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">dDec</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">PA</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">origin</span><span class="o">=</span><span class="default_value">'upper'</span></em>, <em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'nufft'</span></em>, <em class="sig-param"><span class="n">ik</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">saveuvgrid</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/simuv/ft.html#uv_sample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.simuv.ft.uv_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>#galario: scaled with fft-size</p>
<ul class="simple">
<li><p>fourier transform of a model image</p></li>
<li><p>discretized uv sampling using MS uvw</p></li>
</ul>
<p>dRA,dDec optionsare not implemented yet</p>
<dl class="simple">
<dt>method:</dt><dd><dl class="simple">
<dt>‘direct’:     brutal force direct fourier transform using summing (slow, and only okay for a couple of point sources)</dt><dd><p>linear+accurate but slow</p>
</dd>
<dt>‘interp2d’:   this is close to the method implemented in galario (in C or py_sampleImage.py)</dt><dd><p>howerver, galarios linear 2D interp method is problamtics for complicated structure
or multiple offcenter-source (as the amp / phase surface is not smooth)
see related disscussion: <a class="reference external" href="https://github.com/mtazzari/galario/pull/132#issuecomment-396703582">https://github.com/mtazzari/galario/pull/132#issuecomment-396703582</a>
Although interpolae amp/phase is an working solution up to 1% for single simple source at center or offcenter
For more cocmplicated source, the linear interpolation is insuffcient.
The issue is fixed here by introducing high-order spline interpolation, but lose linearrity in XY-UV transform</p>
</dd>
<dt>‘interp2d_ph’: the algroithm used in galario (one should alway interp phase as for point sources)</dt><dd><p>this should give the same results as galario, just slower…</p>
</dd>
<dt>‘galario’:    call galario python API interface (see the problem above)</dt><dd><p>currently, it will linear-interp amp and linear-interp phase.
different from linear-interp real/imag</p>
</dd>
</dl>
</dd>
</dl>
<p>Some options to improve presion/accuracy</p>
<blockquote>
<div><dl class="simple">
<dt>interpolate in UV (be careful) REAL/IMAG or AMP/PH (preferred)</dt><dd><p>low-order if amp/phase smooth
high-order if amp/phase complicated.</p>
</dd>
</dl>
<p>direct FFT (expensive)
oversampling UV grid (expensive)</p>
<p>disaeemble different objects (adjust input facet size) for performance and simplify UV-plane surface</p>
<p>the power pixel location within the input image determine the ripple in phase/real/imag</p>
</div></blockquote>
<p>important note:</p>
<blockquote>
<div><dl class="simple">
<dt>When using any interpolation-based method, for best precision/accurancy, it’s better to</dt><dd><ol class="arabic simple">
<li><p>keep the source emission close to the input image pixel center and perform re-phasing (i.a. dRA/dDec) in UV to get the correct results
In this way, the amp/phase is rather a smooth function, and interp2d will work best even at low-order (e.g. linear interp)</p></li>
<li><p>it’s better to interpolate amp and phase rather than interpolate real/image especially when phase (therefore real/image, this is off-center case)</p></li>
<li><p>(offset from image center) / (half image size) is roughly the sample step in one wrap</p></li>
<li><dl class="simple">
<dt>The most critical thing:</dt><dd><p>depress the phase change in the UV grid to make the “degridding” (i.a interpolate to discretc point) precise.
also be careful about uv sampling beyond UV grid range.
the phase change is determined by the source location in the fft-ready image.
dRA,dDec could help to adjust as it phaseshift is more precise rathatan shifting object location in pixel image</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
</div></blockquote>
<p>Rule:</p>
<blockquote>
<div><p>Imsize larger than twice of object size</p>
</div></blockquote>
<dl class="simple">
<dt>For estimating effeciency:</dt><dd><p>if uv.size&gt;im.size, then interpolating or nearest is likely faster</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ism3d.simuv.ft.uv_sample_direct.html" class="btn btn-neutral float-right" title="ism3d.simuv.ft.uv_sample_direct" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ism3d.simuv.ft.html" class="btn btn-neutral float-left" title="ism3d.simuv.ft" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Rui Xue

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>