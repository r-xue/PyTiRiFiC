

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ism3d.maths.stats &mdash; ism3d 0.3.dev1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ism3d
          

          
          </a>

          
            
            
              <div class="version">
                0.3.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Specification/Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/inpfile.html">Parameter File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/keywords.html">Keywords</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/goals.html">Design Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/ack.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/seealso.html">See also</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/dictionary.html">ISM3D Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../develop/callgraph.html">ISM3D call graph</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Direct API Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_api_uvhelper.html">ism3d.uvhelper: visibility imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_api_arts.html">ism3d.arts: model artificial sources in different shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_api_lens.html">ism3d.arts.lens: model artificial sources with gravitational lensing effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_api_maskmoment.html">ism3d.xyhelper.maskmoment: derive moment0/moment1 maps from spectral cubes</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/demo_invert_ft.html">Invert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/test_uvsample_performance.html">Test the performance of the Image-to-MS-related modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Modeling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_b4c2_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 2 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_b4c5_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 5 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_b6c3_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 6 Cycle 3 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_model_1dspec.html">Invert Visibility + Plot 1D spectra (may take a while)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_emcee.html">Example BX610: perform model fitting using method=‘emcee’</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_hxmm01_simulate.html">Example HXMM01: test the MS-simulation modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Data Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_gn20_prep.html">Example: GN20 (z~4 SMF) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_prep.html">Example: BX610 (High-z SFG) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_hxmm01_prep.html">Example: HXMM01 (High-z Merger)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_gn20_imaging.html">Example GN20: perform imaging of CO 2-1 dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demo_bx610_imaging.html">Example: BX610 (High-z SFG) : Data Imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/ism3d.html">ism3d</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ism3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>ism3d.maths.stats</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ism3d.maths.stats</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span> <span class="k">as</span> <span class="n">sc</span>

<span class="c1"># https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous.html</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">rv_continuous</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">hypsecant</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">logistic</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span><span class="n">SFC64</span><span class="p">,</span><span class="n">PCG64</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Note</span>
<span class="sd">    + see the rv_continous base class explaination here:</span>
<span class="sd">        https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html</span>
<span class="sd">    + see subclassing template here:</span>
<span class="sd">        scipy/stats/_continuous_distns.py</span>
<span class="sd">    + to avoid the sub-class wrapper, one can calculate ppf by directly calling special function</span>
<span class="sd">    + performance of ufunc</span>
<span class="sd">        https://stackoverflow.com/questions/3985619/how-to-calculate-a-logistic-sigmoid-function-in-python</span>

<span class="sd">One np.random performance:</span>

<span class="sd">    np.random.RandomState is using the legacy MT generator, which is slower than the new implemnation:</span>
<span class="sd">        https://docs.scipy.org/doc/numpy/reference/random/legacy.html#numpy.random.mtrand.RandomState</span>
<span class="sd">        </span>
<span class="sd">    mordern &quot;generator&quot;</span>
<span class="sd">        https://docs.scipy.org/doc/numpy/reference/random/generator.html#numpy.random.Generator</span>
<span class="sd">        https://docs.scipy.org/doc/numpy/reference/random/index.html</span>
<span class="sd">        https://docs.scipy.org/doc/numpy/reference/random/new-or-different.html</span>
<span class="sd">        https://numpy.org/neps/nep-0019-rng-policy.html</span>
<span class="sd">    </span>
<span class="sd">    performance:</span>
<span class="sd">        https://docs.scipy.org/doc/numpy/reference/random/performance.html</span>
<span class="sd">     from numpy.random import Generator,SFC64,PCG64</span>
<span class="sd">     seed=1      </span>
<span class="sd">     rg_default=Generator(PCG64(seed))</span>
<span class="sd">     rg_fast=Generator(SFC64(seed))</span>
<span class="sd">     %time rg_default.standard_normal(150*100000)    # PCG64 </span>
<span class="sd">     %time rg_fast.standard_normal(150*100000)       # SFC64</span>
<span class="sd">     %time np.random.standard_normal(150*100000)     # Legacy (MT)</span>
<span class="sd">     </span>
<span class="sd">    rng_old = np.random.RandomState(seeds[1])</span>
<span class="sd">    rng_new = Generator(SFC64(seed))</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##############################</span>

<div class="viewcode-block" id="sersic2d_gen"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.sersic2d_gen.html#ism3d.maths.stats.sersic2d_gen">[docs]</a><span class="k">class</span> <span class="nc">sersic2d_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rho Distribution of a axisymatteric 2D distribution with a Sersic radial profile</span>
<span class="sd">    template from: </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        
        <span class="n">bn</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">fpdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">bn</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">r</span>
        <span class="n">fint</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">bn</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fpdf</span><span class="o">/</span><span class="n">fint</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># a direct call will vectize n while .rvs doesn&#39;t do it</span>
        <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>    
            <span class="c1"># lambertw will be slightly faster than gammainvinv in this application</span>
            <span class="n">b1</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">/</span><span class="n">b1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bn</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">bn</span><span class="p">)</span><span class="o">**</span><span class="n">n</span></div>
    
<span class="n">sersic2d</span> <span class="o">=</span> <span class="n">sersic2d_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="expon2d_gen"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.expon2d_gen.html#ism3d.maths.stats.expon2d_gen">[docs]</a><span class="k">class</span> <span class="nc">expon2d_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#     def _pdf(self,r):</span>
<span class="c1">#         &quot;&quot;&quot;not done</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         fpdf=np.exp(-r)*r</span>
<span class="c1">#         fint=1</span>
<span class="c1">#         </span>
<span class="c1">#         return fpdf/fint</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">real</span> </div>
    
<span class="n">expon2d</span> <span class="o">=</span> <span class="n">expon2d_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;expon2d&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="norm2d_gen"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.norm2d_gen.html#ism3d.maths.stats.norm2d_gen">[docs]</a><span class="k">class</span> <span class="nc">norm2d_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rho Distribution of a axisymatteric 2D distribution with a Gaussian radial profile</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#     def _pdf(self,r):</span>
<span class="c1">#         &quot;&quot;&quot;not done</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         bn=sc.gammaincinv(2*n, 0.5)</span>
<span class="c1">#         fpdf=np.exp(-bn*(r**(1/n)-1))*r</span>
<span class="c1">#         fint=n*np.exp(bn)/(bn**(2*n))*sc.gamma(2*n)</span>
<span class="c1">#         </span>
<span class="c1">#         return fpdf/fint</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span></div>
    
<span class="n">norm2d</span> <span class="o">=</span> <span class="n">norm2d_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;norm2d&#39;</span><span class="p">)</span>

<span class="c1">##############################</span>

<span class="n">norm</span>  <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1">#   https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.hypsecant.html</span>
<span class="n">sech</span>  <span class="o">=</span> <span class="n">hypsecant</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">logistic = exp(-x)/(1+exp(-x))^2 = 1/(2+exp(-x)+exp(x))</span>
<span class="sd">norm(sech) = 2 / (2+exp(-2*x)+exp(2*x))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">sech2</span> <span class="o">=</span> <span class="n">logistic</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<div class="viewcode-block" id="sechsq_gen"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.sechsq_gen.html#ism3d.maths.stats.sechsq_gen">[docs]</a><span class="k">class</span> <span class="nc">sechsq_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile</span>
<span class="sd">    this is a direct implementation for testing, one should use sech2 instead</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#     def _pdf(self,r):</span>
<span class="c1">#         &quot;&quot;&quot;not done</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         fpdf=np.exp(-r)*r</span>
<span class="c1">#         fint=1</span>
<span class="c1">#         </span>
<span class="c1">#         return fpdf/fint</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="c1"># = np.arctanh(2*p-1)           </span>
        <span class="c1"># = 0.5*sc.logit(p)             </span>
        <span class="c1"># = 0.5*np.log(p/(1-p)) = 0.5*np.log(-1+1/(1-p))</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        p=np.random.rand(int(1e7))</span>
<span class="sd">        %timeit -r 1 p=np.random.rand(int(1e8))</span>
<span class="sd">        %timeit -r 1 ne.evaluate(&#39;0.5*log(p/(1-p))&#39;)  # 0.25s threading</span>
<span class="sd">        %timeit -r 1 0.5*sc.logit(p)                  # 1s (one C-level)</span>
<span class="sd">        %timeit -r 1 np.arctanh(2*p-1)                # 2s 50% slower</span>
<span class="sd">        %timeit -r 1 0.5*np.log(p/(1-p))              # 1.7s</span>
<span class="sd">        %timeit -r 1 (-0.5)*np.log(1/p-1)             # 1.4s (&gt;one C-level operation) </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<span class="n">sechsq</span> <span class="o">=</span> <span class="n">sechsq_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sechsq&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="laplace_gen"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.laplace_gen.html#ism3d.maths.stats.laplace_gen">[docs]</a><span class="k">class</span> <span class="nc">laplace_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rho Distribution of a axisymatteric 2D distribution with a Exponential radial profile</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;not done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fpdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span>
        <span class="n">fint</span><span class="o">=</span><span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">fpdf</span><span class="o">/</span><span class="n">fint</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        
        <span class="n">up</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">up</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">up</span><span class="p">))</span></div>
    
<span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;laplace&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="rng_seeded"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.rng_seeded.html#ism3d.maths.stats.rng_seeded">[docs]</a><span class="k">def</span> <span class="nf">rng_seeded</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a seeded RNG plus is_mkl</span>
<span class="sd">    mkl_random is preferrred over numpy.random </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">mkl_random</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Generator</span><span class="p">(</span><span class="n">SFC64</span><span class="p">(</span><span class="n">seed</span><span class="p">)),</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mkl_random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span> <span class="kc">True</span>  <span class="c1"># , brng = brng_algo</span></div>
    
    
<span class="c1">#############################################################</span>


<div class="viewcode-block" id="custom_rvs"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.custom_rvs.html#ism3d.maths.stats.custom_rvs">[docs]</a><span class="k">def</span> <span class="nf">custom_rvs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
               <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">interp</span><span class="o">=</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>    <span class="c1"># only for slow sersic2d expon2d cases</span>
               <span class="n">sersic_n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>          <span class="c1"># only for sersic2d</span>
               <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.random.RandomState.html#numpy.random.RandomState</span>
<span class="sd">    use_nprng==True:</span>
<span class="sd">        use np built-in random generator rather than the hardcoded uniform+its formula </span>
<span class="sd">    more ppf rvs can be found here:</span>
<span class="sd">        https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py</span>
<span class="sd">        scipy try to use special.fun as much as possible due to performance gain</span>
<span class="sd">        </span>
<span class="sd">    performance:</span>
<span class="sd">        scipy.stats.rvs is generally slowest as the wrapper</span>
<span class="sd">        A Good in-line ITS is usually fast and comparable to rng.dist (which still use C underhood)</span>
<span class="sd">        </span>
<span class="sd">        rvs=</span>
<span class="sd">        </span>
<span class="sd">    When size is large, the ppf calculation can slow down the ITS (ur-&gt;x);</span>
<span class="sd">    If interp is specificed as a two-element tuple, we will use the pre-calculated ur-&gt;x table to performance the transform</span>
<span class="sd">    interp=(a,b) ; (a,b) determined the random variable PDF accuracy, in units of &quot;scale&quot; </span>
<span class="sd">        a: resolution (so the uncernraiy in x should be smaller than a*scale</span>
<span class="sd">        b: beyond b*scale, the transform is truncated and we lost the PDF accuracy in the random variable.</span>
<span class="sd">    smaller a or large b will increase the computation time.</span>
<span class="sd">    </span>
<span class="sd">    if interp is None then, the custom_ppf method is used and the compulation time will incrase with size=1.0</span>
<span class="sd">    if interp is set as default, the computing time will flatten at some point as size increase. </span>
<span class="sd">    </span>
<span class="sd">    When using interp for inverse transformation, the better accurate in x within a limit dynamical range setting</span>
<span class="sd">    is determined by which part of sampling table is usable for interpolation.</span>
<span class="sd">    For oneside or twoside function, this is typically x-SF as saving numerican value SF can catpture</span>
<span class="sd">    x change at large x (with close to zero SF) with good enough precsion.</span>
<span class="sd">    </span>
<span class="sd">    note: np.interp(x,xp,xf) works faster if x is sorted; however, there is cost of sorting random number</span>
<span class="sd">          the bottleneck is here is still np.interp()  </span>
<span class="sd">          https://github.com/numpy/numpy/issues/10937</span>
<span class="sd">          </span>
<span class="sd">    func:    string / built-in function formula</span>
<span class="sd">             dict / {&#39;x&#39;:x,&#39;cdf&#39;:cdf} cdf-x is the CDF function</span>
<span class="sd">                    {&#39;y&#39;:y,&#39;sf&#39;:sf}   sf-x  is the surveve function</span>
<span class="sd">             this feature is used for the case where the PPF is not analytical for the distribution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">rng</span><span class="o">=</span><span class="n">Generator</span><span class="p">(</span><span class="n">SFC64</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
    
    <span class="k">if</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span> 
        <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;cdf&#39;</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
            <span class="n">q</span><span class="o">=</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;cdf&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;sf&#39;</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
            <span class="n">q</span><span class="o">=</span><span class="n">func</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span>
        <span class="c1"># one must make sure cdf &amp; sf is spanning between (0,1)</span>
        <span class="n">rv</span> <span class="o">=</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">q</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">rv</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span><span class="n">q</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span> 
          
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;uniform2d&#39;</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># \prop~r/scale (r&lt;scale)   this is for simulating rho-random variable </span>
        <span class="c1">#                           of a 2D pan-cake distribution </span>
        <span class="c1">#</span>
        <span class="n">rv</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span> 
          
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;expon2d&#39;</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># \prop~r*exp(-r/scale): r&gt;0</span>
        <span class="c1">#</span>
        <span class="c1"># no implementation in scipy.stats &amp; numpy.random, we use an in-line formula </span>
        <span class="c1">#see rv=custom_ppf(&#39;expon2d&#39;,rng.rand(size))</span>
        <span class="k">if</span>  <span class="n">interp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rv</span><span class="o">=</span><span class="n">custom_ppf</span><span class="p">(</span><span class="s1">&#39;expon2d&#39;</span><span class="p">,</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_sampling</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">interp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">interp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">sf_sampling</span><span class="o">=</span><span class="n">custom_sf</span><span class="p">(</span><span class="s1">&#39;expon2d&#39;</span><span class="p">,</span><span class="n">x_sampling</span><span class="p">)</span>
            <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="n">sf_sampling</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x_sampling</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span> 

    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*sersic(r/scale,n,re=1) r&gt;0</span>
        <span class="c1"># scale=1 ==&gt; re=1</span>
        <span class="c1">#</span>
        <span class="c1"># no implementation in scipy.stats &amp; numpy.random, we use an in-line formula </span>
        <span class="k">if</span>  <span class="n">interp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rv</span><span class="o">=</span><span class="n">custom_ppf</span><span class="p">(</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">,</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="n">sersic_n</span><span class="o">=</span><span class="n">sersic_n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_sampling</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">interp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">interp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">interp</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">sf_sampling</span><span class="o">=</span><span class="n">custom_sf</span><span class="p">(</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">,</span><span class="n">x_sampling</span><span class="p">,</span><span class="n">sersic_n</span><span class="o">=</span><span class="n">sersic_n</span><span class="p">)</span>
            <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">((</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)),</span><span class="n">sf_sampling</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x_sampling</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span> 
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;norm2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*exp(-(r/scale)^2/2) r&gt;0</span>
        <span class="c1">#</span>
        <span class="c1"># no implementation in scipy.stats, we use an in-line formula</span>
        <span class="c1"># the more general formula is not any faster</span>
        <span class="c1">#</span>
        <span class="c1"># technically should be rv=np.sqrt(2)*np.sqrt(-np.log(1-u))</span>
        <span class="c1"># see: rv=custom_ppf(&#39;norm2d&#39;,rng.rand(size)) </span>
        <span class="c1"># but we reduce the math operation by replace 1-u with u</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)))</span> 
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span>
        <span class="c1">#rv=rng.weibull(2,size=int(size)) # slow due to overhead</span>
        <span class="c1">#rv=rng.rayleigh(scale=1.0,size=int(size)) # slow due to overhead</span>
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~sech(z/scale) -inf&lt;z&lt;+inf</span>
        <span class="c1"># https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.hypsecant.html#scipy.stats.hypsecant</span>
        <span class="c1">#</span>
        <span class="c1"># no implementation in scipy.stats &amp; numpy.random, we use an in-line formula</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">custom_ppf</span><span class="p">(</span><span class="s1">&#39;sech&#39;</span><span class="p">,</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">))</span> 
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span>
        <span class="c1">#rv=hypsecant.rvs(size=int(size),random_state=seed)    # give the same results</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech2&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~sech^2(z/scale) -inf&lt;z&lt;+inf</span>
        <span class="c1">#</span>
        <span class="c1">#rv=np.arctanh(1-2*u)</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">custom_ppf</span><span class="p">(</span><span class="s1">&#39;sech2&#39;</span><span class="p">,</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>  <span class="c1"># comparable to rng.logistic</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span> <span class="n">rv</span><span class="o">*=</span><span class="n">scale</span>       
        <span class="c1">#rv=rng.logistic(loc=0.0,scale=0.5*scale,size=int(size))</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;laplace&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~exp(-|z|) -inf&lt;z&lt;+inf</span>
        <span class="c1">#</span>
        <span class="c1">#rv=custom_ppf(&#39;laplace&#39;,rng.rand(size))</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">rng</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="c1"># faster since it&#39;s calculated at C-level</span>
        <span class="c1">#</span>
        <span class="c1">#ur=rng.rand(size)</span>
        <span class="c1">#rv=np.where(ur&gt;0.5,-np.log(2*(1-ur)), np.log(2*ur))</span>
        
        <span class="c1">#ur=rng.uniform(low=-1,high=1,size=size)</span>
        <span class="c1">#rv=-np.sign(ur)*sc.log1p(np.abs(ur))</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span>
        <span class="c1">#rv=custom_ppf(&#39;norm&#39;,rng.rand(size))</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="c1"># faster since it&#39;s calculated at C-level</span>
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;uniform&#39;</span><span class="p">:</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">scale</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">rv</span></div>

<div class="viewcode-block" id="custom_sf"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.custom_sf.html#ism3d.maths.stats.custom_sf">[docs]</a><span class="k">def</span> <span class="nf">custom_sf</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">sersic_n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The relation between x and q (i.e. CDF) is used to transfer uniform standard random variables to the desired sampling</span>
<span class="sd">    for a specified PDF. If .ppf can be writtten in analytical forms, we can call funtions to directly calculate.</span>
<span class="sd">    However, if special functions are involved, the computation cost can be high and an pre-calculated transform table</span>
<span class="sd">    can be used. </span>
<span class="sd">    </span>
<span class="sd">    To Keep numerical precision and meet the sampling gridding error requirementaion (that is the sampling transfer error </span>
<span class="sd">    in X_{i} is smaller than pixel size / bin size. It&#39;s easier to build the table from a regular oversamped grid in x,</span>
<span class="sd">    then calculate the crosspoding p value (within 0~1). Of course the regular oversamped x value can not go to +finity,</span>
<span class="sd">    and an upper limit should be given:</span>
<span class="sd">        e.g. x_grid=np.linspace(0,100,10000) may be good enought for &quot;expon2d&quot;,</span>
<span class="sd">            this means the transfered x from interpolated should have error(x)&lt;=0.01Re (as we use linear interp to </span>
<span class="sd">            replace the actual curve), withinin 100Re (more than </span>
<span class="sd">            enought for our modeling accuray)</span>
<span class="sd">            </span>
<span class="sd">    However, another numerical problem may occare as large x may lead to very close to 1 in this case, and numercial </span>
<span class="sd">            accurcy may degrade lead to 1: see:</span>
<span class="sd">            https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html</span>
<span class="sd">            note on _logsf</span>
<span class="sd">            and the test_custom_ppf_learn(): x=100 will lead to q=1 rather than something cose to zero.</span>
<span class="sd">    The solution is calculate sf=1-q=1-CDF or logsf=log(1-q)=log(1-CDF); </span>
<span class="sd">    then the small deviation from 1 can still be acturrately represented numerically. And we can use x vs. logsf table to transfer ur to x-domain acurrate enought for gridding purpose</span>
<span class="sd">    </span>
<span class="sd">    The computer is good at saving small number close to zero rather than a number very close to one.</span>
<span class="sd">        https://scicomp.stackexchange.com/questions/20629/when-should-log1p-and-expm1-be-used</span>
<span class="sd">        </span>
<span class="sd">    note: the interplation method is only used for the transform in which the calculatione becomes to expensive</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    The inverse function x=isf(sf):</span>
<span class="sd">        if sf is a uniform (0-1) random variable, then x should follow the desired distribution</span>
<span class="sd">    </span>
<span class="sd">    use sf instead of CDF is for numerical precsion purpose.</span>
<span class="sd">    </span>
<span class="sd">    We only use this to build interpolation table for expensive case; so only func=&#39;expon2d&#39; &amp; &#39;sersic2d&#39;</span>
<span class="sd">    are implemented.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;expon2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*exp(-r): r&gt;0</span>
        <span class="c1"># https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.sc.lambertw.html</span>
        <span class="n">sf</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*sersic(r,n,re=1) r&gt;0</span>
        <span class="n">bn</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sersic_n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sersic_n</span><span class="p">,</span><span class="n">bn</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sersic_n</span><span class="p">))</span> 

    <span class="k">return</span> <span class="n">sf</span></div>

<div class="viewcode-block" id="custom_pdf"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.custom_pdf.html#ism3d.maths.stats.custom_pdf">[docs]</a><span class="k">def</span> <span class="nf">custom_pdf</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">sersic_n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    note:</span>
<span class="sd">        the pdf values is not normalized: int(pdf*dx) is not one!</span>
<span class="sd">    Although we can use scipy.stats, we write a customized code here to improve performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sersic&#39;</span><span class="p">:</span>
        <span class="n">bn</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sersic_n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="n">bn</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sersic_n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;expon&#39;</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech&#39;</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech2&#39;</span><span class="p">:</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">=</span><span class="n">tmp</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tmp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">pdf</span></div>
    
<div class="viewcode-block" id="custom_ppf"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.custom_ppf.html#ism3d.maths.stats.custom_ppf">[docs]</a><span class="k">def</span> <span class="nf">custom_ppf</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">sersic_n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *** we also wrap the random generator into rv_continous class ***</span>
<span class="sd">    *** but this inline function may have better performance without the error checking overhead in rv_continous class</span>
<span class="sd">    </span>
<span class="sd">    To build a fast persodu-random genenrator for an analytical function, the key is calculate the inverse cumlutative </span>
<span class="sd">    diftributon function or Percent Point Function  (PPF) in high precisiom:</span>
<span class="sd">    This is the parameter reliazation values as a function of CDF (Percent point function):</span>
<span class="sd">        https://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.stats.norm.html</span>
<span class="sd">        https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous.html</span>
<span class="sd">        https://github.com/scipy/scipy/blob/master/scipy/stats/_continuous_distns.py</span>
<span class="sd">        https://docs.scipy.org/doc/scipy/reference/special.html</span>
<span class="sd">        </span>
<span class="sd">    Sometimes this function will have an analytical form, which will be good in terms of performance and precision.</span>
<span class="sd">    </span>
<span class="sd">    should support vector</span>
<span class="sd">    Although this is 1D, any fancy function can be further manupilated</span>
<span class="sd">    </span>
<span class="sd">    https://reference.wolfram.com/language/ref/InverseCDF.html</span>
<span class="sd">    </span>
<span class="sd">    calculate ppf from percent cutoff for common (regularized/normalized) PDF </span>
<span class="sd">    this can be used for inverse transform sampling</span>
<span class="sd">    </span>
<span class="sd">    *****</span>
<span class="sd">    If &quot;u&quot; is an uniform random number from (0,1), then the output would be </span>
<span class="sd">    a sample following the desired distribution </span>
<span class="sd">    *****</span>
<span class="sd">    </span>
<span class="sd">    see also the appendix Xue+2020</span>
<span class="sd">    </span>
<span class="sd">    see also: inverseCDF.nb in MM12</span>
<span class="sd">    </span>
<span class="sd">    If &quot;-ss&quot; is in the function name, we will use scipy.stats build-in RV class</span>
<span class="sd">    </span>
<span class="sd">    + typicall using scipy.special will be faster</span>
<span class="sd">    </span>
<span class="sd">    to use this function as inverse survive function (ISF)</span>
<span class="sd">    try:</span>
<span class="sd">        sp=1-q</span>
<span class="sd">        x=custom_ppf(func,sp)</span>
<span class="sd">    </span>
<span class="sd">    sersic_n only works for func=&quot;sersic2d&quot;</span>
<span class="sd">    </span>
<span class="sd">    The interpolation sample should stay in:</span>
<span class="sd">        x &lt;-&gt; SF or x &lt;-&gt;log(SF) space</span>
<span class="sd">    As it&#39;s difficult to keep the numerical accuracy and x &lt;-&gt; CDF for large x + close to one CDF table</span>
<span class="sd">    : when you set up a x grid, for large x, the corrspoding CDF will one due to numerical precision</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;expon2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*exp(-r): r&gt;0</span>
        <span class="c1"># https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.sc.lambertw.html</span>
        <span class="n">rv</span><span class="o">=-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">((</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">,</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
          
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sersic2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*sersic(r,n,re=1) r&gt;0</span>
        <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sersic_n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>    
            <span class="c1"># lambertw will be slightly faster than gammainvinv in this application</span>
            <span class="n">b1</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">((</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">,</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">real</span> <span class="p">)</span><span class="o">/</span><span class="n">b1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bn</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sersic_n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">rv</span><span class="o">=</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sersic_n</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">bn</span><span class="p">)</span><span class="o">**</span><span class="n">sersic_n</span>        
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;norm2d&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~r*exp(-r^2/2) r&gt;0</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>
    
    
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~sech(z) -inf&lt;z&lt;+inf</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="c1">#also see:</span>
        <span class="c1">#    scipy/stats/_continuous_distns.py</span>
        <span class="c1"># https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.hypsecant.html#scipy.stats.hypsecant</span>
        <span class="c1"># rv=stats.hypersecant.ppf(x)    # give the same results</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;sech2&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~sech^2(z) -inf&lt;z&lt;+inf</span>
        <span class="c1">#rv=np.arctanh(1-2*u)</span>
        <span class="n">rv</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="c1"># faster</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;laplace&#39;</span><span class="p">:</span>
        <span class="c1"># \prop~exp(-|z|) -inf&lt;z&lt;+inf</span>
        <span class="n">up</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">up</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">up</span><span class="p">))</span>
        
    <span class="k">if</span>  <span class="n">func</span><span class="o">==</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span>
        <span class="c1">#rv=np.sqrt(2)*sc.erfinv(2*u-1)</span>
        <span class="n">rv</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="c1"># faster</span>
        
    <span class="k">return</span> <span class="n">rv</span></div>
    
<div class="viewcode-block" id="pdf2rv_nd"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.pdf2rv_nd.html#ism3d.maths.stats.pdf2rv_nd">[docs]</a><span class="k">def</span> <span class="nf">pdf2rv_nd</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
              <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">interp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pseudo-random sample (approximately) following a target PDF specified by a n-dimension array</span>
<span class="sd">    The inverse transform sampling approach is used without expensive MC.</span>
<span class="sd">    see more details here:</span>
<span class="sd">        https://stackoverflow.com/questions/21100716/fast-arbitrary-distribution-random-sampling/21101584#21101584</span>
<span class="sd">    </span>
<span class="sd">    Note:</span>
<span class="sd">        + A over-sampled PDF grid (with pdf_sort/pdf_interp=True) is preferred for accuracy.</span>
<span class="sd">        + For a input PDF with a shape of (ny,nx), the output will be</span>
<span class="sd">            xpos=sample[0,0]</span>
<span class="sd">            ypos=sample[1,:]</span>
<span class="sd">            xpos and ypos will be in 0-based pixel index units (i.a.xypos=[0,0] means the first pixel center.)</span>
<span class="sd">            This convention follow the FITS image format layout.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pdf_shape</span><span class="o">=</span><span class="n">pdf</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">pdf_flat</span><span class="o">=</span><span class="n">pdf</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="k">if</span>  <span class="n">sort</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">sortindex</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">pdf_flat</span><span class="o">=</span><span class="n">pdf_flat</span><span class="p">[</span><span class="n">sortindex</span><span class="p">]</span>
    <span class="n">cdf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pdf_flat</span><span class="p">)</span>

    <span class="n">choice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="n">cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="n">choice</span><span class="p">)</span>

    <span class="k">if</span>  <span class="n">sort</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">index</span><span class="o">=</span><span class="n">sortindex</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">pdf_shape</span><span class="p">))</span>

    <span class="k">if</span>  <span class="n">interp</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sample</span></div>

<div class="viewcode-block" id="cdf2rv"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.cdf2rv.html#ism3d.maths.stats.cdf2rv">[docs]</a><span class="k">def</span> <span class="nf">cdf2rv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cdf</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    **** only here for backward compaibility *****</span>
<span class="sd">    </span>
<span class="sd">    Generate a pseudo-random random variable set following a target distribution described by the CDF,</span>
<span class="sd">    using the inverse transform / pesudo-random number sampling method</span>
<span class="sd">    </span>
<span class="sd">    The input CDF is presumed to be sorted already with mono increasing trend. </span>
<span class="sd">    </span>
<span class="sd">    The result should stay within the range of cdf_x</span>
<span class="sd">    </span>
<span class="sd">    this is for backward compaibility</span>
<span class="sd">    make sure</span>
<span class="sd">        x[0] cdf=0</span>
<span class="sd">        x[-1] cdf=1</span>
<span class="sd">    </span>
<span class="sd">    icdf=interpolate.interp1d(y_cdf,x,kind=&#39;linear&#39;)</span>
<span class="sd">    # icdf: inverse cumulative distribution function</span>
<span class="sd">    # a.k.a Percent point function (inverse of `cdf`)</span>
<span class="sd">    # https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous</span>
<span class="sd">    # It seems that scipy.interpolate mess up units when x.type is QUANTITY</span>
<span class="sd">    return icdf(pick) </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">custom_rvs</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;cdf&#39;</span><span class="p">:</span><span class="n">cdf</span><span class="p">},</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> </div>


<div class="viewcode-block" id="pdf2rv"><a class="viewcode-back" href="../../../_autosummary/ism3d.maths.stats.pdf2rv.html#ism3d.maths.stats.pdf2rv">[docs]</a><span class="k">def</span> <span class="nf">pdf2rv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pdf</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pseudo-random random variable set following a target distribution described by the PDF</span>
<span class="sd">    using the inverse transform / pesudo-random number sampling method</span>
<span class="sd">    </span>
<span class="sd">    The result should stay within the range of pdf_x</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cdf</span><span class="o">=</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">initial</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">cdf</span><span class="o">/=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cdf</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">custom_rvs</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;cdf&#39;</span><span class="p">:</span><span class="n">cdf</span><span class="p">},</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span></div>



        
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Rui Xue

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>