

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ism3d.xyhelper.maskmoment package &mdash; ism3d 0.3.dev1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_astrorefs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> ism3d
          

          
          </a>

          
            
            
              <div class="version">
                0.3.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Specification/Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/inpfile.html">Parameter File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/keywords.html">Keywords</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/maintain.html">Maintance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/goals.html">Design Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/ack.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/seealso.html">See also</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/dictionary.html">ISM3D Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/callgraph.html">ISM3D call graph</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Direct API Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_uvhelper.html">ism3d.uvhelper: visibility imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_arts.html">ism3d.arts: model artificial sources in different shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_lens.html">ism3d.arts.lens: model artificial sources with gravitational lensing effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_api_maskmoment.html">ism3d.xyhelper.maskmoment: derive moment0/moment1 maps from spectral cubes</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/demo_invert_ft.html">Invert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/test_uvsample_performance.html">Test the performance of the Image-to-MS-related modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Modeling</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c2_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 2 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b4c5_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 4 Cycle 5 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_b6c3_uv_ab.html">Example BX610: perform model fitting using method=‘amoeba’ for the Band 6 Cycle 3 DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_model_1dspec.html">Invert Visibility + Plot 1D spectra (may take a while)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_emcee.html">Example BX610: perform model fitting using method=‘emcee’</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_simulate.html">Example HXMM01: test the MS-simulation modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials: Data Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_prep.html">Example: GN20 (z~4 SMF) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_prep.html">Example: BX610 (High-z SFG) : Data Prep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_hxmm01_prep.html">Example: HXMM01 (High-z Merger)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_gn20_imaging.html">Example GN20: perform imaging of CO 2-1 dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo_bx610_imaging.html">Example: BX610 (High-z SFG) : Data Imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/demo_notebook.html">Tutorials &amp; Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/ism3d.html">ism3d</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ism3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ism3d.xyhelper.maskmoment package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="ism3d-xyhelper-maskmoment-package">
<h1>ism3d.xyhelper.maskmoment package<a class="headerlink" href="#ism3d-xyhelper-maskmoment-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-ism3d.xyhelper.maskmoment.maskmoment">
<span id="ism3d-xyhelper-maskmoment-maskmoment-module"></span><h2>ism3d.xyhelper.maskmoment.maskmoment module<a class="headerlink" href="#module-ism3d.xyhelper.maskmoment.maskmoment" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.maskmoment.maskmoment">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.maskmoment.</code><code class="sig-name descname">maskmoment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img_fits</span></em>, <em class="sig-param"><span class="n">gain_fits</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">rms_fits</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mask_fits</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">outdir</span><span class="o">=</span><span class="default_value">'.'</span></em>, <em class="sig-param"><span class="n">outname</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">snr_hi</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">snr_lo</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">minbeam</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">snr_hi_minch</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">snr_lo_minch</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">min_tot_ch</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">nguard</span><span class="o">=</span><span class="default_value">[0, 0]</span></em>, <em class="sig-param"><span class="n">edgech</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">fwhm</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vsm</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vsm_type</span><span class="o">=</span><span class="default_value">'gauss'</span></em>, <em class="sig-param"><span class="n">mom1_minch</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">mom2_minch</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">altoutput</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">output_snr_cube</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">output_snr_peak</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">output_snrsm_cube</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">output_2d_mask</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">to_kelvin</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">huge_operations</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">perpixel</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/maskmoment.html#maskmoment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.maskmoment.maskmoment" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce FITS images of moment maps using a dilated masking approach.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul>
<li><p><strong>img_fits</strong> (<em>FITS file name, required</em>) – The image cube, this should be in units of K, Jy/beam, or equivalent.</p></li>
<li><p><strong>gain_fits</strong> (<em>FITS file name, optional</em>) – The gain cube, e.g. pb cube from CASA.  This should have a value between
0 and 1, with 0 near the edges and 1 near the center of the image, and
have the same dimensions as the image cube.
NOTE: The gain cube is ignored if a noise cube (rms_fits) is given.</p></li>
<li><p><strong>rms_fits</strong> (<em>FITS file name, optional</em>) – The noise cube, providing an estimate of the rms noise at each pixel.
This should have the same dimensions and units as the image cube.
NOTE: If rms_fits is not given, a noise cube is generated from the
image cube, after removing any gain variation using the gain cube.</p></li>
<li><p><strong>mask_fits</strong> (<em>FITS file name, optional</em>) – External mask cube to use.  This cube should have 1’s for valid pixels
and 0’s for excluded pixels.  If this is provided then the mask generation
is skipped and the program goes straight to calculating the moments.</p></li>
<li><p><strong>outdir</strong> (<em>string, optional</em>) – Directory to write the output files.
Default: Write to the directory where img_fits resides.
NOTE: Currently this directory is assumed to exist.</p></li>
<li><p><strong>outname</strong> (<em>string, optional</em>) – Basename for output files.  For instance, outname=’foo’ produces files
‘foo.mom0.fits.gz’, etc.
Default: Based on root name of img_fits.</p></li>
<li><p><strong>snr_hi</strong> (<em>float, optional</em>) – The high significance sigma threshold from which to begin mask dilation.
Default: 4</p></li>
<li><p><strong>snr_lo</strong> (<em>float, optional</em>) – The low significance sigma threshold at which to end mask dilation.
Default: 2</p></li>
<li><p><strong>snr_hi_minch</strong> (<em>int, optional</em>) – High significance mask is required to span at least this many channels
at all pixels.
Default: 1</p></li>
<li><p><strong>snr_lo_minch</strong> (<em>int, optional</em>) – Low significance mask is required to span at least this many channels
at all pixels.
Default: 1</p></li>
<li><p><strong>min_tot_ch</strong> (<em>int, optional</em>) – Each contiguous mask region must span at least this many channels (but
it’s not necessary that every pixel in the region span this many channels).
Default: 2</p></li>
<li><p><strong>minbeam</strong> (<em>float, optional</em>) – Minimum velocity-integrated area of a mask region in units of the beam size.
Default: 1</p></li>
<li><p><strong>nguard</strong> (<em>tuple of two ints, optional</em>) – Expand the final mask by nguard[0] pixels in the sky directions and
nguard[1] channels in velocity.  Currently these values must be equal
if both are non-zero.
If nguard[0] = 0 then no expansion is done in sky coordinates.
If nguard[1] = 0 then no expansion is done in velocity.
Default: [0,0]</p></li>
<li><p><strong>edgech</strong> (<em>int, optional</em>) – Number of channels at each end of vel axis to use for rms estimation.
Default: 5</p></li>
<li><p><strong>fwhm</strong> (float or <code class="xref py py-class docutils literal notranslate"><span class="pre">Quantity</span></code>, optional) – Spatial resolution to smooth to before generating the dilated mask.
If value is not an astropy quantity, assumed to be given in arcsec.
Default: No spatial smoothing is applied.</p></li>
<li><p><strong>vsm</strong> (float or <code class="xref py py-class docutils literal notranslate"><span class="pre">Quantity</span></code>, optional) – Full width of the spectral smoothing kernel (or FWHM for gaussian).
If given as astropy quantity, should be given in velocity units.
If not given as astropy quantity, interpreted as number of channels.
Default: No spectral smoothing is applied.</p></li>
<li><p><strong>vsm_type</strong> (<em>string, optional</em>) – What type of spectral smoothing to employ.  Currently three options:
(1) ‘boxcar’ - 1D boxcar smoothing, vsm rounded to integer # of chans.
(2) ‘gauss’ - 1D gaussian smoothing, vsm is the convolving gaussian FWHM.
(3) ‘gaussfinal’ - 1D gaussian smoothing, vsm is the gaussian FWHM</p>
<blockquote>
<div><p>after convolution, assuming FWHM before convolution is 1 channel.</p>
</div></blockquote>
<p>Default: ‘gauss’</p>
</li>
<li><p><strong>mom1_minch</strong> (<em>int, optional</em>) – Minimum number of unmasked channels needed to calculate moment-1.
Default: 2</p></li>
<li><p><strong>mom2_minch</strong> (<em>int, optional</em>) – Minimum number of unmasked channels needed to calculate moment-2.
Default: 2</p></li>
<li><p><strong>perpixel</strong> (<em>boolean, optional</em>) – Whether to calculate the rms per XY pixel instead of over whole image.
Set to True if you know there is a sensitivity variation across the image
but you don’t have a gain cube - requires rms_fits and gain_fits unset.
Default: False</p></li>
<li><p><strong>output_snr_cube</strong> (<em>boolean, optional</em>) – Output the cube in SNR units in addition to the moment maps.
Default: False</p></li>
<li><p><strong>output_snr_peak</strong> (<em>boolean, optional</em>) – Output the peak SNR image in addition to the moment maps.
Default: False</p></li>
<li><p><strong>output_snrsm_cube</strong> (<em>boolean, optional</em>) – Output the smoothed cube in SNR units in addition to the moment maps.
Default: False</p></li>
<li><p><strong>output_2d_mask</strong> (<em>boolean, optional</em>) – Output the projected 2-D mask as well as the newly generated mask.
The projected mask at a given pixel is valid for all channels as
long as the parent mask is valid for any channel.
Default: False</p></li>
<li><p><strong>to_kelvin</strong> (<em>boolean, optional</em>) – Output the moment maps in K units if the cube is in Jy/beam units.
Default: True</p></li>
<li><p><strong>altoutput</strong> (<em>boolean, optional</em>) – Also output moment maps from a “direct” calculation instead of
the moment method in spectral_cube.  Mainly used for debugging.
Default: False</p></li>
<li><p><strong>huge_operations</strong> (<em>boolean, optional</em>) – Allow huge operations in spectral_cube.
Default: True</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.xyhelper.maskmoment.momfuncs">
<span id="ism3d-xyhelper-maskmoment-momfuncs-module"></span><h2>ism3d.xyhelper.maskmoment.momfuncs module<a class="headerlink" href="#module-ism3d.xyhelper.maskmoment.momfuncs" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.calc_moments">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">calc_moments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">imcube</span></em>, <em class="sig-param"><span class="n">rmscube</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#calc_moments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.calc_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate moments of a masked cube and their errors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imcube</strong> (<em>SpectralCube</em>) – The image cube for which to calculate the moments and their errors.</p></li>
<li><p><strong>rmscube</strong> (<em>SpectralCube</em>) – A cube representing the noise estimate at each location in the image
cube.  Should have the same units as the image cube.</p></li>
<li><p><strong>mask</strong> (<cite>~numpy.ndarray</cite>) – A binary mask array (0s and 1s) to be applied before measuring the flux
and uncertainty.  This should NOT be a SpectralCube.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>altmom</strong> (<cite>~numpy.ndarray</cite>) – A stack of the three moment maps.  These are generally redundant since
they were previously calculated by SpectralCube.</p></li>
<li><p><strong>errmom</strong> (<cite>~numpy.ndarray</cite>) – A stack of the three uncertainty maps.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.dilmsk">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">dilmsk</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">snrcube</span></em>, <em class="sig-param"><span class="n">header</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">snr_hi</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">snr_lo</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">minbeam</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">snr_hi_minch</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">snr_lo_minch</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">min_tot_ch</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">nguard</span><span class="o">=</span><span class="default_value">[0, 0]</span></em>, <em class="sig-param"><span class="n">debug</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#dilmsk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.dilmsk" title="Permalink to this definition">¶</a></dt>
<dd><p>Dilate a mask from one specified threshold to another.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>snrcube</strong> (SpectralCube or <cite>~numpy.ndarray</cite>) – The image cube normalized by the estimated RMS noise.  If a numpy array
is provided the header must also be provided.</p></li>
<li><p><strong>header</strong> (<cite>astropy.io.fits.Header</cite>) – The cube FITS header, required if a numpy array is given.</p></li>
<li><p><strong>snr_hi</strong> (<em>float, optional</em>) – The high significance threshold from which to begin the mask dilation.
Default: 4</p></li>
<li><p><strong>snr_lo</strong> (<em>float, optional</em>) – The low significance threshold at which to end the mask dilation.
Default: 2</p></li>
<li><p><strong>minbeam</strong> (<em>float, optional</em>) – Minimum velocity-integrated area of a mask region in units of the beam size.
Default: 1</p></li>
<li><p><strong>snr_hi_minch</strong> (<em>int, optional</em>) – High significance mask is required to span at least this many channels
at all pixels.
Default: 1</p></li>
<li><p><strong>snr_lo_minch</strong> (<em>int, optional</em>) – Low significance mask is required to span at least this many channels
at all pixels.
Default: 1</p></li>
<li><p><strong>min_tot_ch</strong> (<em>int, optional</em>) – Dilated mask regions are required to span at least this many channels.
Default: 2</p></li>
<li><p><strong>nguard</strong> (<em>tuple of two ints, optional</em>) – Expand the final mask by this nguard[0] pixels in sky directions and
nguard[1] channels in velocity.  Currently these values must be equal
if both are non-zero.
If nguard[0] = 0 then no expansion is done in sky coordinates.
If nguard[1] = 0 then no expansion is done in velocity.
Default: [0,0]</p></li>
<li><p><strong>debug</strong> (<em>boolean, optional</em>) – Output a bunch of FITS files to diagnose what’s going on.
Default: False</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>dil_mask</strong> – A binary mask array (0s and 1s) which can be applied to a cube</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>~numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.findflux">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">findflux</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">imcube</span></em>, <em class="sig-param"><span class="n">rmscube</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">projmask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#findflux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.findflux" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate integrated spectrum and total integrated flux.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imcube</strong> (<em>SpectralCube</em>) – The image cube over which to measure the flux.</p></li>
<li><p><strong>rmscube</strong> (<em>SpectralCube</em>) – A cube representing the noise estimate at each location in the image
cube.  Should have the same units as the image cube.</p></li>
<li><p><strong>mask</strong> (<cite>~numpy.ndarray</cite>) – A binary mask array (0s and 1s) to be applied before measuring the flux
and uncertainty.  This should NOT be a SpectralCube.</p></li>
<li><p><strong>projmask</strong> (<cite>~numpy.ndarray</cite>) – A second mask array within which to measure the flux and uncertainty.
This is normally the 2-D projected mask.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fluxtab</strong> – A 3-column table providing the velocity, flux, and uncertainty.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.makenoise">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">makenoise</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cubearray</span></em>, <em class="sig-param"><span class="n">gainarray</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">rms</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">perpixel</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">edge</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">clip</span><span class="o">=</span><span class="default_value">0.2</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#makenoise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.makenoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a data cube and an optional gain cube, estimate the noise at each position,
using the robust mad_std estimator in astropy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cubearray</strong> (SpectralCube or <cite>~numpy.ndarray</cite>) – The input data cube.  No default.</p></li>
<li><p><strong>gainarray</strong> (SpectralCube or <cite>~numpy.ndarray</cite>, optional) – Gain of a point source at each position of the cube (typically 0 to 1).
Can be 2-D or 3-D image, e.g. from pb.fits file from CASA.
Default is to assume the rms is constant with position.</p></li>
<li><p><strong>rms</strong> (<em>float, optional</em>) – Global estimate of the rms noise, to be used instead of trying
to estimate it from the data.  It should have the units of the input cube.
Default is to calculate the rms from the data.</p></li>
<li><p><strong>perpixel</strong> (<em>boolean, optional</em>) – Whether to calculate the rms per pixel instead of over whole image.
Set to True if you know there is a sensitivity variation across the image
but you don’t have a gain cube.  Only used if rms is unset.
Default: False</p></li>
<li><p><strong>edge</strong> (<em>int, optional</em>) – Number of channels at left and right edges of each spectrum to use
for rms estimation.
Default is to use all channels.</p></li>
<li><p><strong>clip</strong> (<em>float, optional</em>) – Pixels below this value in the input gainarray are marked invalid.
Default: 0.2</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>noisecube *or* noisearray</strong> – The noise estimate as a 3-D array with the same shape and units as
the input cube.
If the input cube was a SpectralCube, a SpectralCube is returned.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SpectralCube or <cite>~numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.maskguard">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">maskguard</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">maskarray</span></em>, <em class="sig-param"><span class="n">niter</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">xyonly</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">vonly</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#maskguard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.maskguard" title="Permalink to this definition">¶</a></dt>
<dd><p>Pad a mask by specified number of pixels in all three dimensions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maskarray</strong> (<cite>~numpy.ndarray</cite>) – The 3-D mask array with 1s for valid pixels and 0s otherwise.</p></li>
<li><p><strong>niter</strong> (<em>int, optional</em>) – Number of iterations for expanding mask by binary dilation.
Default: 1</p></li>
<li><p><strong>xyonly</strong> (<em>boolean, optional</em>) – Whether to expand only in the two sky coordinates
Default: False</p></li>
<li><p><strong>vonly</strong> (<em>boolean, optional</em>) – Whether to expand only in the spectral coordinate
Default: False (ignored if xyonly==True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>maskarray</strong> – A copy of the input maskarray after padding.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>~numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.prunemask">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">prunemask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">maskarray</span></em>, <em class="sig-param"><span class="n">minarea</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">minch</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">byregion</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#prunemask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.prunemask" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply area and velocity width criteria on mask regions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maskarray</strong> (<cite>~numpy.ndarray</cite>) – The 3-D mask array with 1s for valid pixels and 0s otherwise.</p></li>
<li><p><strong>minarea</strong> (<em>int, optional</em>) – Minimum velocity-integrated area in pixel units.
Default: 0</p></li>
<li><p><strong>minch</strong> (<em>int, optional</em>) – Minimum velocity width in channel units.
Default: 2</p></li>
<li><p><strong>byregion</strong> (<em>boolean, optional</em>) – Whether to enforce min velocity width on whole region, rather than by pixel
Default: True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>maskarray</strong> – A copy of the input maskarray with regions failing the tests removed.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>~numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.smcube">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">smcube</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">snrcube</span></em>, <em class="sig-param"><span class="n">header</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">fwhm</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vsm</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">vsm_type</span><span class="o">=</span><span class="default_value">'gauss'</span></em>, <em class="sig-param"><span class="n">edgech</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#smcube"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.smcube" title="Permalink to this definition">¶</a></dt>
<dd><p>Smooth an SNRcube to produce a higher signal-to-noise SNRcube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>snrcube</strong> (SpectralCube or <cite>~numpy.ndarray</cite>) – The image cube normalized by the estimated RMS noise.  If a numpy array
is provided the header must also be provided.</p></li>
<li><p><strong>header</strong> (<cite>astropy.io.fits.Header</cite>) – The cube FITS header, required if a numpy array is given.</p></li>
<li><p><strong>fwhm</strong> (float or <code class="xref py py-class docutils literal notranslate"><span class="pre">Quantity</span></code>, optional) – Final spatial resolution to smooth to.  If not astropy quantity, assumed
to be given in arcsec.
Default: 10 arcsec</p></li>
<li><p><strong>vsm</strong> (float or <code class="xref py py-class docutils literal notranslate"><span class="pre">Quantity</span></code>, optional) – Full width of the spectral smoothing kernel (or FWHM if gaussian).
If given as astropy quantity, should be given in velocity units.
If not given as astropy quantity, interpreted as number of channels.
Default: No spectral smoothing is applied.</p></li>
<li><p><strong>vsm_type</strong> (<em>string, optional</em>) – What type of spectral smoothing to employ.  Currently three options:
(1) ‘boxcar’ - 1D boxcar smoothing, vsm rounded to integer # of chans.
(2) ‘gauss’ - 1D gaussian smoothing, vsm is the convolving gaussian FWHM.
(3) ‘gaussfinal’ - 1D gaussian smoothing, vsm is the gaussian FWHM
after convolution, assuming FWHM before convolution is 1 channel.
Default: ‘gauss’</p></li>
<li><p><strong>edgech</strong> (<em>int, optional</em>) – Number of channels at left and right edges of each spectrum to use
for rms estimation.
Default is to use all channels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>sm_snrcube</strong> – A cube is SNR units after smoothing to the desired resolution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SpectralCube</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="ism3d.xyhelper.maskmoment.momfuncs.writemom">
<code class="sig-prename descclassname">ism3d.xyhelper.maskmoment.momfuncs.</code><code class="sig-name descname">writemom</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">imarray</span></em>, <em class="sig-param"><span class="n">filename</span><span class="o">=</span><span class="default_value">'outfile'</span></em>, <em class="sig-param"><span class="n">type</span><span class="o">=</span><span class="default_value">'mom1'</span></em>, <em class="sig-param"><span class="n">hdr</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ism3d/xyhelper/maskmoment/momfuncs.html#writemom"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ism3d.xyhelper.maskmoment.momfuncs.writemom" title="Permalink to this definition">¶</a></dt>
<dd><p>Write out a moment map as a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imarray</strong> (SpectralCube or <cite>~numpy.ndarray</cite>) – The 2D array with the moment map values</p></li>
<li><p><strong>filename</strong> (<em>string</em>) – The root of the file name</p></li>
<li><p><strong>type</strong> (<em>string</em>) – A label for the filename extension</p></li>
<li><p><strong>hdr</strong> (<cite>astropy.io.fits.Header</cite>) – The FITS header to write out</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-ism3d.xyhelper.maskmoment">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ism3d.xyhelper.maskmoment" title="Permalink to this headline">¶</a></h2>
<p>submodule maskmoment</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Rui Xue

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>